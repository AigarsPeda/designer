import{f as y,d as ie,u as Ce,b as ke,r as v,e as De,o as se,c as le,a as $e,_ as ye,w as Ie,g as Oe}from"./index-b032dae7.js";const xe=e=>{if(!e){console.error("makeAllObjCanvasUnselectable: canvas is null");return}e.selection=!1,e.discardActiveObject(),e.forEachObject(t=>{t.setOptions({evented:!1,selectable:!1,hasControls:!1,hasRotatingPoint:!1})})},ve=e=>{if(!e.length)return"";const t=e.reduce((n,[r,i],s,l)=>{const[o,a]=l[(s+1)%l.length];return n.push(r,i,(r+o)/2,(i+a)/2),n},["M",...e[0],"Q"]);return t.push("Z"),t.join(" ")},Ae=()=>`id-${Math.random().toString(16).slice(2)}`;function he(e,t,n,r=i=>i){return e*r(.5-t*(.5-n))}function Re(e){return[-e[0],-e[1]]}function k(e,t){return[e[0]+t[0],e[1]+t[1]]}function _(e,t){return[e[0]-t[0],e[1]-t[1]]}function C(e,t){return[e[0]*t,e[1]*t]}function Be(e,t){return[e[0]/t,e[1]/t]}function F(e){return[e[1],-e[0]]}function de(e,t){return e[0]*t[0]+e[1]*t[1]}function ze(e,t){return e[0]===t[0]&&e[1]===t[1]}function Fe(e){return Math.hypot(e[0],e[1])}function Le(e){return e[0]*e[0]+e[1]*e[1]}function pe(e,t){return Le(_(e,t))}function Se(e){return Be(e,Fe(e))}function Te(e,t){return Math.hypot(e[1]-t[1],e[0]-t[0])}function L(e,t,n){let r=Math.sin(n),i=Math.cos(n),s=e[0]-t[0],l=e[1]-t[1],o=s*i-l*r,a=s*r+l*i;return[o+t[0],a+t[1]]}function re(e,t,n){return k(e,C(_(t,e),n))}function ge(e,t,n){return k(e,C(t,n))}var{min:$,PI:We}=Math,me=.275,T=We+1e-4;function Ye(e,t={}){let{size:n=16,smoothing:r=.5,thinning:i=.5,simulatePressure:s=!0,easing:l=u=>u,start:o={},end:a={},last:w=!1}=t,{cap:m=!0,easing:b=u=>u*(2-u)}=o,{cap:Y=!0,easing:p=u=>--u*u*u+1}=a;if(e.length===0||n<=0)return[];let d=e[e.length-1].runningLength,O=o.taper===!1?0:o.taper===!0?Math.max(n,d):o.taper,A=a.taper===!1?0:a.taper===!0?Math.max(n,d):a.taper,ue=Math.pow(n*r,2),R=[],D=[],Z=e.slice(0,10).reduce((u,h)=>{let c=h.pressure;if(s){let f=$(1,h.distance/n),Q=$(1,1-f);c=$(1,u+(Q-u)*(f*me))}return(u+c)/2},e[0].pressure),g=he(n,i,e[e.length-1].pressure,l),q,N=e[0].vector,B=e[0].point,X=B,j=B,P=X,J=!1;for(let u=0;u<e.length;u++){let{pressure:h}=e[u],{point:c,vector:f,distance:Q,runningLength:z}=e[u];if(u<e.length-1&&d-z<3)continue;if(i){if(s){let M=$(1,Q/n),te=$(1,1-M);h=$(1,Z+(te-Z)*(M*me))}g=he(n,i,h,l)}else g=n/2;q===void 0&&(q=g);let Me=z<O?b(z/O):1,je=d-z<A?p((d-z)/A):1;g=Math.max(.01,g*Math.min(Me,je));let ce=(u<e.length-1?e[u+1]:e[u]).vector,ee=u<e.length-1?de(f,ce):1,Pe=de(f,N)<0&&!J,fe=ee!==null&&ee<0;if(Pe||fe){let M=C(F(N),g);for(let te=1/13,V=0;V<=1;V+=te)j=L(_(c,M),c,T*V),R.push(j),P=L(k(c,M),c,T*-V),D.push(P);B=j,X=P,fe&&(J=!0);continue}if(J=!1,u===e.length-1){let M=C(F(f),g);R.push(_(c,M)),D.push(k(c,M));continue}let ae=C(F(re(ce,f,ee)),g);j=_(c,ae),(u<=1||pe(B,j)>ue)&&(R.push(j),B=j),P=k(c,ae),(u<=1||pe(X,P)>ue)&&(D.push(P),X=P),Z=h,N=f}let x=e[0].point.slice(0,2),S=e.length>1?e[e.length-1].point.slice(0,2):k(e[0].point,[1,1]),K=[],U=[];if(e.length===1){if(!(O||A)||w){let u=ge(x,Se(F(_(x,S))),-(q||g)),h=[];for(let c=1/13,f=c;f<=1;f+=c)h.push(L(u,x,T*2*f));return h}}else{if(!(O||A&&e.length===1))if(m)for(let h=1/13,c=h;c<=1;c+=h){let f=L(D[0],x,T*c);K.push(f)}else{let h=_(R[0],D[0]),c=C(h,.5),f=C(h,.51);K.push(_(x,c),_(x,f),k(x,f),k(x,c))}let u=F(Re(e[e.length-1].vector));if(A||O&&e.length===1)U.push(S);else if(Y){let h=ge(S,u,g);for(let c=1/29,f=c;f<1;f+=c)U.push(L(h,S,T*3*f))}else U.push(k(S,C(u,g)),k(S,C(u,g*.99)),_(S,C(u,g*.99)),_(S,C(u,g)))}return R.concat(U,D.reverse(),K)}function Xe(e,t={}){var n;let{streamline:r=.5,size:i=16,last:s=!1}=t;if(e.length===0)return[];let l=.15+(1-r)*.85,o=Array.isArray(e[0])?e:e.map(({x:p,y:d,pressure:O=.5})=>[p,d,O]);if(o.length===2){let p=o[1];o=o.slice(0,-1);for(let d=1;d<5;d++)o.push(re(o[0],p,d/4))}o.length===1&&(o=[...o,[...k(o[0],[1,1]),...o[0].slice(2)]]);let a=[{point:[o[0][0],o[0][1]],pressure:o[0][2]>=0?o[0][2]:.25,vector:[1,1],distance:0,runningLength:0}],w=!1,m=0,b=a[0],Y=o.length-1;for(let p=1;p<o.length;p++){let d=s&&p===Y?o[p].slice(0,2):re(b.point,o[p],l);if(ze(b.point,d))continue;let O=Te(d,b.point);if(m+=O,p<Y&&!w){if(m<i)continue;w=!0}b={point:d,pressure:o[p][2]>=0?o[p][2]:.5,vector:Se(_(b.point,d)),distance:O,runningLength:m},a.push(b)}return a[0].vector=((n=a[1])==null?void 0:n.vector)||[0,0],a}function Ue(e,t={}){return Ye(Xe(e,t),t)}var Ve=Ue;const be="drawnObjects";let E=!1,ne=[[0,0]],I=null;const Ee=({canvas:e,drawingMode:t})=>{if(!e){console.error("drawStrokeOnCanvas: canvas is null");return}e==null||e.off("mouse:up"),e==null||e.off("mouse:move"),e==null||e.off("mouse:down"),e.on("mouse:down",n=>{E=!0,I=null;const r=e.getPointer(n.e);ne=[[r.x,r.y]]}),e.on("mouse:move",n=>{if(!E)return;e.discardActiveObject();const r=e.getPointer(n.e);ne.push([r.x,r.y]);const i=Ve(ne,{size:t.size,thinning:t.thinning,smoothing:t.smoothing,streamline:t.streamline,easing(l){return l=Math.max(0,Math.min(1,l)),l*l*(3-2*l)}}),s=ve(i);y.fabric.loadSVGFromString(`<svg>
         <path fill="${t.stroke}" d="${s}" />
      </svg>`,l=>{const o=new y.fabric.Group(l,{id:be,selectable:!1,hasRotatingPoint:!1});I=o,e.add(o)})}),e.on("mouse:up",n=>{if(!E)return;const i=e.getObjects().filter(s=>(s==null?void 0:s.id)===be);if(i.length>0&&I){for(let s=0;s<i.length;s++)e.remove(i[s]);I.setOptions({selectable:!0,id:Ae(),hasRotatingPoint:!0}),I.bringForward(!0),e.add(I),e.renderAll()}xe(e),E=!1})},Ge=(e,t)=>{if(e)return setTimeout(()=>e.requestRenderAll(),t)},He=({canvas:e,backgroundColor:t})=>{e&&e.setBackgroundColor(t,()=>Ge(e,0))};let G=0,H=0,oe=!1;const Ze=({canvas:e})=>{e&&(e==null||e.off("mouse:up"),e==null||e.off("mouse:move"),e==null||e.off("mouse:down"),e.on("mouse:down",t=>{var n,r,i;if(oe=!0,t&&t.e&&t.e.type==="touchstart"){const s=t.e;G=(n=s==null?void 0:s.changedTouches[0])==null?void 0:n.clientX,H=(r=s==null?void 0:s.changedTouches[0])==null?void 0:r.clientY}(i=t.target)==null||i.setOptions({opacity:.5})}),e.on("mouse:move",t=>{if(!(!oe||!t||!t.e||t.target)){if(t.e.type==="mousemove"){const n=new y.fabric.Point(t.e.movementX,t.e.movementY);e.relativePan(n)}if(t.e.type==="touchmove"){const n=t.e,r=n==null?void 0:n.touches[0];if(!r)return;const i=.9;let s=(r.clientX-G)*i,l=(r.clientY-H)*i;G=r.clientX,H=r.clientY;const o=new y.fabric.Point(s,l);e.relativePan(o)}}}),e.on("mouse:up",t=>{var n;oe=!1,(n=t.target)==null||n.setOptions({opacity:1}),G=0,H=0}))},qe=({canvas:e,containerRef:t})=>{const n=(t==null?void 0:t.offsetWidth)||500,r=(t==null?void 0:t.offsetHeight)||500;e==null||e.setDimensions({width:n,height:r})},Ne=({canvas:e})=>{e.on("mouse:wheel",t=>{const n=t.e.deltaY;let r=e.getZoom();r*=.999**n,r>20&&(r=20),r<.01&&(r=.01),e.zoomToPoint({x:t.e.offsetX,y:t.e.offsetY},r),t.e.preventDefault(),t.e.stopPropagation()})},Je=e=>{e==null||e.off("mouse:up"),e==null||e.off("mouse:move"),e==null||e.off("mouse:down")},W=25,Ke=.5,Qe="fill:#64748b;stroke:#64748b;stroke-width:0.5;",et=[[W,0],[0,0],[W,W],[0,W]],tt=({size:e=W,radius:t=Ke,circleStyle:n=Qe,circlePositions:r=et})=>`<svg width="${e/2}" height="${e/2}" viewBox="0 0 ${e/2} ${e/2}" version="1.1" xmlns="http://www.w3.org/2000/svg"><defs/><g>
    ${r.map(([i,s])=>`<circle style="${n}" cx="${i}" cy="${s}" r="${t}"/>`).join(`
`)}
    </g></svg>`,nt=({svgString:e})=>`data:image/svg+xml;utf8,${encodeURIComponent(e)}`,ot=()=>new y.fabric.Pattern({source:nt({svgString:tt({})}),repeat:"repeat"}),rt=ie({__name:"FabricCanvas",props:{id:{}},emits:["mouse:dblclick","canvas-created"],setup(e,{emit:t}){Ce(),ke();const n=v(null),r=v(null),i=v({width:0,height:0}),s=v(null);return De(()=>{var o,a,w,m;const l=new y.fabric.Canvas(s.value,{width:((o=r.value)==null?void 0:o.offsetWidth)||500,height:((a=r.value)==null?void 0:a.offsetHeight)||500});l&&(n.value=l,t("canvas-created",l),l.on("mouse:dblclick",()=>{t("mouse:dblclick")}),i.value={width:((w=r.value)==null?void 0:w.offsetWidth)||500,height:((m=r.value)==null?void 0:m.offsetHeight)||500},Ne({canvas:l}),window.addEventListener("resize",()=>{qe({canvas:l,containerRef:r.value})}))}),(l,o)=>(se(),le("div",{class:"container",ref_key:"containerRef",ref:r},[$e("canvas",{id:"canvas",ref_key:"canvasReference",ref:s,width:500,height:500},null,512)],512))}});const it=ye(rt,[["__scopeId","data-v-e56d0c65"]]),_e=({canvas:e,action:t})=>{e==null||e.off("mouse:up"),e==null||e.off("mouse:move"),e==null||e.off("mouse:down"),e==null||e.on("mouse:up",n=>{const i=e.getActiveObjects().map(s=>(s==null?void 0:s.id)||"no id");if(i.length>0){t("ObjContextMenu",i);return}t("mainMenu",[])})},we=e=>e==="drawing"||e==="panning",st=e=>{if(!e){console.error("makeAllObjCanvasSelectable: canvas is null");return}e.selection=!0,e==null||e.forEachObject(t=>{t.setOptions({evented:!0,selectable:!0,hasControls:!0,hasRotatingPoint:!0})})},lt=ie({__name:"MainDesign",setup(e){const t=Ce(),n=ke(),r=v(null),i=v(null),s=l=>{i.value=l;const o=l.getCenter();new y.fabric.Circle({radius:20,fill:"#4f46e5",top:o.top+100,left:o.left+100}),new y.fabric.Triangle({width:60,height:70,fill:"#c026d3",top:o.top+50,left:o.left+50}),new y.fabric.IText("Test text",{fontSize:22,top:o.top,left:o.left,hasControls:!0,fontStyle:"normal",fontWeight:"normal",fontFamily:"Helvetica"}),new y.fabric.Line([80,10,200,150],{stroke:"#374151"}),new y.fabric.Polyline([{x:80,y:10},{x:200,y:150},{x:500,y:250}],{stroke:"#ea580c",fill:"transparent",strokeWidth:5,strokeLineCap:"round",strokeLineJoin:"round"}),console.log("handleCreated --->",l)};return Ie([t,n],l=>{const{getDrawingMode:o}=l[1],{getIsDotBackground:a,getCanvasMode:w}=l[0];switch(we(w)&&xe(i.value),we(w)||st(i.value),w){case"drawing":Ee({canvas:i.value,drawingMode:o});break;case"panning":Ze({canvas:i.value});break;case"mainMenu":_e({canvas:i.value,action:(m,b)=>{t.setCanvasMode({canvasMode:m}),n.setSelectedObjectIds({selectedObjectIds:b})}});break;case"ObjContextMenu":_e({canvas:i.value,action:(m,b)=>{n.setSelectedObjectIds({selectedObjectIds:b}),t.setCanvasMode({canvasMode:m})}});break;default:Je(i.value);break}He({canvas:i.value,backgroundColor:a?ot():"transparent"})}),(l,o)=>(se(),le("div",{class:"design-canvas-container",ref_key:"elRef",ref:r},[Oe(it,{onCanvasCreated:s,id:"1"})],512))}});const ut=ye(lt,[["__scopeId","data-v-e3557c36"]]),ft=ie({__name:"DesignView",setup(e){return(t,n)=>(se(),le("main",null,[Oe(ut)]))}});export{ft as default};
