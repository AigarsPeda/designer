import{d as fe,u as Oe,b as xe,r as U,e as Ie,f as w,o as ce,c as de,a as Be,_ as je,w as We,g as Me}from"./index-a69b4fbf.js";const Ye=({canvas:e,containerRef:t})=>{const n=(t==null?void 0:t.offsetWidth)||500,o=(t==null?void 0:t.offsetHeight)||500;e==null||e.setDimensions({width:n,height:o})},Le=({canvas:e})=>{e.on("mouse:wheel",t=>{const n=t.e.deltaY;let o=e.getZoom();o*=.999**n,o>20&&(o=20),o<.01&&(o=.01),e.zoomToPoint({x:t.e.offsetX,y:t.e.offsetY},o),t.e.preventDefault(),t.e.stopPropagation()})},Xe=fe({__name:"FabricCanvas",props:{id:{}},emits:["mouse:dblclick","canvas-created"],setup(e,{emit:t}){Oe(),xe();const n=U(null),o=U(null),i=U({width:0,height:0}),r=U(null);return Ie(()=>{var l,f,O,y;const s=new w.fabric.Canvas(r.value,{width:((l=o.value)==null?void 0:l.offsetWidth)||500,height:((f=o.value)==null?void 0:f.offsetHeight)||500});s&&(n.value=s,t("canvas-created",s),s.on("mouse:dblclick",()=>{t("mouse:dblclick")}),i.value={width:((O=o.value)==null?void 0:O.offsetWidth)||500,height:((y=o.value)==null?void 0:y.offsetHeight)||500},Le({canvas:s}),window.addEventListener("resize",()=>{Ye({canvas:s,containerRef:o.value})}),window.addEventListener("keydown",m=>{if(m.key==="Backspace"){const x=s.getActiveObject();if(!x)return;s.remove(x)}}))}),(s,l)=>(ce(),de("div",{class:"container",ref_key:"containerRef",ref:o},[Be("canvas",{id:"canvas",ref_key:"canvasReference",ref:r,width:500,height:500},null,512)],512))}});const ze=je(Xe,[["__scopeId","data-v-9ccb0b2b"]]),Se=e=>{if(!e){console.error("makeAllObjCanvasUnselectable: canvas is null");return}e.selection=!1,e.discardActiveObject(),e.forEachObject(t=>{t.setOptions({evented:!1,selectable:!1,hasControls:!1,hasRotatingPoint:!1})})},Fe=e=>{if(!e.length)return"";const t=e.reduce((n,[o,i],r,s)=>{const[l,f]=s[(r+1)%s.length];return n.push(o,i,(o+l)/2,(i+f)/2),n},["M",...e[0],"Q"]);return t.push("Z"),t.join(" ")},Pe=()=>`id-${Math.random().toString(16).slice(2)}`;function me(e,t,n,o=i=>i){return e*o(.5-t*(.5-n))}function Te(e){return[-e[0],-e[1]]}function k(e,t){return[e[0]+t[0],e[1]+t[1]]}function b(e,t){return[e[0]-t[0],e[1]-t[1]]}function _(e,t){return[e[0]*t,e[1]*t]}function Ee(e,t){return[e[0]/t,e[1]/t]}function X(e){return[e[1],-e[0]]}function be(e,t){return e[0]*t[0]+e[1]*t[1]}function Ue(e,t){return e[0]===t[0]&&e[1]===t[1]}function Ve(e){return Math.hypot(e[0],e[1])}function Ge(e){return e[0]*e[0]+e[1]*e[1]}function we(e,t){return Ge(b(e,t))}function De(e){return Ee(e,Ve(e))}function He(e,t){return Math.hypot(e[1]-t[1],e[0]-t[0])}function z(e,t,n){let o=Math.sin(n),i=Math.cos(n),r=e[0]-t[0],s=e[1]-t[1],l=r*i-s*o,f=r*o+s*i;return[l+t[0],f+t[1]]}function ue(e,t,n){return k(e,_(b(t,e),n))}function _e(e,t,n){return k(e,_(t,n))}var{min:R,PI:Ze}=Math,ke=.275,F=Ze+1e-4;function ve(e,t={}){let{size:n=16,smoothing:o=.5,thinning:i=.5,simulatePressure:r=!0,easing:s=u=>u,start:l={},end:f={},last:O=!1}=t,{cap:y=!0,easing:m=u=>u*(2-u)}=l,{cap:x=!0,easing:g=u=>--u*u*u+1}=f;if(e.length===0||n<=0)return[];let a=e[e.length-1].runningLength,C=l.taper===!1?0:l.taper===!0?Math.max(n,a):l.taper,B=f.taper===!1?0:f.taper===!0?Math.max(n,a):f.taper,he=Math.pow(n*o,2),W=[],A=[],K=e.slice(0,10).reduce((u,h)=>{let c=h.pressure;if(r){let d=R(1,h.distance/n),ne=R(1,1-d);c=R(1,u+(ne-u)*(d*ke))}return(u+c)/2},e[0].pressure),p=me(n,i,e[e.length-1].pressure,s),Q,q=e[0].vector,Y=e[0].point,G=Y,D=Y,$=G,ee=!1;for(let u=0;u<e.length;u++){let{pressure:h}=e[u],{point:c,vector:d,distance:ne,runningLength:L}=e[u];if(u<e.length-1&&a-L<3)continue;if(i){if(r){let S=R(1,ne/n),re=R(1,1-S);h=R(1,K+(re-K)*(S*ke))}p=me(n,i,h,s)}else p=n/2;Q===void 0&&(Q=p);let $e=L<C?m(L/C):1,Ae=a-L<B?g((a-L)/B):1;p=Math.max(.01,p*Math.min($e,Ae));let ae=(u<e.length-1?e[u+1]:e[u]).vector,oe=u<e.length-1?be(d,ae):1,Re=be(d,q)<0&&!ee,ge=oe!==null&&oe<0;if(Re||ge){let S=_(X(q),p);for(let re=1/13,Z=0;Z<=1;Z+=re)D=z(b(c,S),c,F*Z),W.push(D),$=z(k(c,S),c,F*-Z),A.push($);Y=D,G=$,ge&&(ee=!0);continue}if(ee=!1,u===e.length-1){let S=_(X(d),p);W.push(b(c,S)),A.push(k(c,S));continue}let pe=_(X(ue(ae,d,oe)),p);D=b(c,pe),(u<=1||we(Y,D)>he)&&(W.push(D),Y=D),$=k(c,pe),(u<=1||we(G,$)>he)&&(A.push($),G=$),K=h,q=d}let j=e[0].point.slice(0,2),M=e.length>1?e[e.length-1].point.slice(0,2):k(e[0].point,[1,1]),te=[],H=[];if(e.length===1){if(!(C||B)||O){let u=_e(j,De(X(b(j,M))),-(Q||p)),h=[];for(let c=1/13,d=c;d<=1;d+=c)h.push(z(u,j,F*2*d));return h}}else{if(!(C||B&&e.length===1))if(y)for(let h=1/13,c=h;c<=1;c+=h){let d=z(A[0],j,F*c);te.push(d)}else{let h=b(W[0],A[0]),c=_(h,.5),d=_(h,.51);te.push(b(j,c),b(j,d),k(j,d),k(j,c))}let u=X(Te(e[e.length-1].vector));if(B||C&&e.length===1)H.push(M);else if(x){let h=_e(M,u,p);for(let c=1/29,d=c;d<1;d+=c)H.push(z(h,M,F*3*d))}else H.push(k(M,_(u,p)),k(M,_(u,p*.99)),b(M,_(u,p*.99)),b(M,_(u,p)))}return W.concat(H,A.reverse(),te)}function Ne(e,t={}){var n;let{streamline:o=.5,size:i=16,last:r=!1}=t;if(e.length===0)return[];let s=.15+(1-o)*.85,l=Array.isArray(e[0])?e:e.map(({x:g,y:a,pressure:C=.5})=>[g,a,C]);if(l.length===2){let g=l[1];l=l.slice(0,-1);for(let a=1;a<5;a++)l.push(ue(l[0],g,a/4))}l.length===1&&(l=[...l,[...k(l[0],[1,1]),...l[0].slice(2)]]);let f=[{point:[l[0][0],l[0][1]],pressure:l[0][2]>=0?l[0][2]:.25,vector:[1,1],distance:0,runningLength:0}],O=!1,y=0,m=f[0],x=l.length-1;for(let g=1;g<l.length;g++){let a=r&&g===x?l[g].slice(0,2):ue(m.point,l[g],s);if(Ue(m.point,a))continue;let C=He(a,m.point);if(y+=C,g<x&&!O){if(y<i)continue;O=!0}m={point:a,pressure:l[g][2]>=0?l[g][2]:.5,vector:De(b(m.point,a)),distance:C,runningLength:y},f.push(m)}return f[0].vector=((n=f[1])==null?void 0:n.vector)||[0,0],f}function Je(e,t={}){return ve(Ne(e,t),t)}var Ke=Je;const ye="drawnObjects";let v=!1,ie=[[0,0]],I=null;const Qe=({canvas:e,drawingMode:t})=>{if(!e){console.error("drawStrokeOnCanvas: canvas is null");return}e==null||e.off("mouse:up"),e==null||e.off("mouse:move"),e==null||e.off("mouse:down"),e.on("mouse:down",n=>{v=!0,I=null;const o=e.getPointer(n.e);ie=[[o.x,o.y]]}),e.on("mouse:move",n=>{if(!v)return;e.discardActiveObject();const o=e.getPointer(n.e);ie.push([o.x,o.y]);const i=Ke(ie,{size:t.size,thinning:t.thinning,smoothing:t.smoothing,streamline:t.streamline,easing(s){return s=Math.max(0,Math.min(1,s)),s*s*(3-2*s)}}),r=Fe(i);w.fabric.loadSVGFromString(`<svg>
         <path fill="${t.stroke}" d="${r}" />
      </svg>`,s=>{const l=new w.fabric.Group(s,{id:ye,selectable:!1,hasRotatingPoint:!1});I=l,e.add(l)})}),e.on("mouse:up",n=>{if(!v)return;const i=e.getObjects().filter(r=>(r==null?void 0:r.id)===ye);if(i.length>0&&I){for(let r=0;r<i.length;r++)e.remove(i[r]);I.setOptions({selectable:!0,id:Pe(),hasRotatingPoint:!0}),I.bringForward(!0),e.add(I),e.renderAll()}Se(e),v=!1})},qe=(e,t)=>{if(e)return setTimeout(()=>e.requestRenderAll(),t)},et=({canvas:e,backgroundColor:t})=>{e&&e.setBackgroundColor(t,()=>qe(e,0))};let N=0,J=0,se=!1;const tt=({canvas:e})=>{e&&(e==null||e.off("mouse:up"),e==null||e.off("mouse:move"),e==null||e.off("mouse:down"),e.on("mouse:down",t=>{var n,o,i;if(se=!0,t&&t.e&&t.e.type==="touchstart"){const r=t.e;N=(n=r==null?void 0:r.changedTouches[0])==null?void 0:n.clientX,J=(o=r==null?void 0:r.changedTouches[0])==null?void 0:o.clientY}(i=t.target)==null||i.setOptions({opacity:.5})}),e.on("mouse:move",t=>{if(!(!se||!t||!t.e||t.target)){if(t.e.type==="mousemove"){const n=new w.fabric.Point(t.e.movementX,t.e.movementY);e.relativePan(n)}if(t.e.type==="touchmove"){const n=t.e,o=n==null?void 0:n.touches[0];if(!o)return;const i=.9;let r=(o.clientX-N)*i,s=(o.clientY-J)*i;N=o.clientX,J=o.clientY;const l=new w.fabric.Point(r,s);e.relativePan(l)}}}),e.on("mouse:up",t=>{var n;se=!1,(n=t.target)==null||n.setOptions({opacity:1}),N=0,J=0}))},nt=({canvas:e,action:t})=>{e==null||e.off("mouse:up"),e==null||e.off("mouse:move"),e==null||e.off("mouse:down"),e==null||e.on("mouse:up",n=>{const i=e.getActiveObjects().map(r=>(r==null?void 0:r.id)||"no id");if(i.length>0){t("ObjContextMenu",i);return}t("mainMenu",[])})},V=25,ot=.5,rt=[[V,0],[0,0],[V,V],[0,V]],it=({size:e=V,radius:t=ot,fill:n="#ffffff",circleColor:o="#64748b",circlePositions:i=rt})=>{const r=`fill:${o};stroke:${o};stroke-width:0.5;`;return`
  <svg width="${e/2}" height="${e/2}" viewBox="0 0 ${e/2} ${e/2}" version="1.1" xmlns="http://www.w3.org/2000/svg"><defs/><g>
  <rect width="100%" height="100%" fill="${n}" />
    ${i.map(([s,l])=>`<circle style="${r}" cx="${s}" cy="${l}" r="${t}"/>`).join(`
`)}
    </g></svg>`},st=({svgString:e})=>`data:image/svg+xml;utf8,${encodeURIComponent(e)}`,lt=({fill:e,objColor:t})=>new w.fabric.Pattern({source:st({svgString:it({fill:e,circleColor:t})}),repeat:"repeat"});let P="",T=0,E=0,le=!1;const ut=({canvas:e,endAction:t,squareModeSettings:n})=>{if(e){if(e==null||e.off("mouse:up"),e==null||e.off("mouse:move"),e==null||e.off("mouse:down"),P){const i=e.getObjects().find(r=>r.id===P);if(!i)return;i.set({rx:n.rx,ry:n.ry,stroke:n.stroke,fill:n.background,strokeWidth:n.strokeWidth}),e.renderAll()}e.on("mouse:down",o=>{if(P!==""){P="",t();return}le=!0;const i=e.getPointer(o.e);T=i.x,E=i.y;const r=new w.fabric.Rect({angle:0,top:E,left:T,evented:!0,originY:"top",originX:"left",selectable:!0,hasRotatingPoint:!0,width:i.x-T,height:i.y-E,rx:n.rx,ry:n.ry,stroke:n.stroke,fill:n.background,strokeWidth:n.strokeWidth});r.id=Pe(),P=r.id,e.add(r)}),e.on("mouse:move",o=>{if(!le||!P)return;const i=e.getPointer(o.e),s=e.getObjects().find(l=>l.id===P);s&&(T>i.x&&s.set({left:Math.abs(i.x)}),E>i.y&&s.set({top:Math.abs(i.y)}),s.setOptions({width:Math.abs(T-i.x),height:Math.abs(E-i.y)}),e.renderAll())}),e.on("mouse:up",o=>{e.getObjects().find(s=>s.id===P)&&(le=!1)})}},Ce=e=>e==="drawing"||e==="panning",ft=e=>{if(!e){console.error("makeAllObjCanvasSelectable: canvas is null");return}e.selection=!0,e.forEachObject(t=>{t.setOptions({evented:!0,selectable:!0,hasControls:!0,hasRotatingPoint:!0})})},ct=e=>{e==null||e.off("mouse:up"),e==null||e.off("mouse:move"),e==null||e.off("mouse:down")},dt=fe({__name:"MainDesign",setup(e){const t=Oe(),n=xe(),o=U(null),i=r=>{n.setSelectedCanvas({selectedCanvas:r});const s=r.getCenter();new w.fabric.Circle({radius:20,fill:"#4f46e5",top:s.top+100,left:s.left+100}),new w.fabric.Triangle({width:60,height:70,fill:"#c026d3",top:s.top+50,left:s.left+50}),new w.fabric.IText("Test text",{fontSize:22,top:s.top,left:s.left,hasControls:!0,fontStyle:"normal",fontWeight:"normal",fontFamily:"Helvetica"}),new w.fabric.Line([80,10,200,150],{stroke:"#374151"}),new w.fabric.Polyline([{x:80,y:10},{x:200,y:150},{x:500,y:250}],{stroke:"#ea580c",fill:"transparent",strokeWidth:5,strokeLineCap:"round",strokeLineJoin:"round"})};return We(()=>({getCanvasMode:t.getCanvasMode,getDrawingMode:n.getDrawingMode,getIsDotBackground:t.getIsDotBackground,getSelectedCanvas:n.getSelectedCanvas,getSquareModeSettings:n.getSquareModeSettings}),r=>{const{getCanvasMode:s,getDrawingMode:l,getSelectedCanvas:f,getIsDotBackground:O,getSquareModeSettings:y}=r;switch(Ce(s)&&Se(f),Ce(s)||ft(f),t.getCanvasMode){case"drawing":Qe({canvas:f,drawingMode:l});break;case"panning":tt({canvas:f});break;case"square":ut({canvas:f,squareModeSettings:y,endAction:()=>{t.setCanvasMode({canvasMode:"mainMenu"})}});break;case"mainMenu":case"ObjContextMenu":nt({canvas:f,action:(m,x)=>{t.setCanvasMode({canvasMode:m}),n.setSelectedObjectIds({selectedObjectIds:x})}});break;default:ct(f);break}et({canvas:f,backgroundColor:O?lt({}):"transparent"})}),(r,s)=>(ce(),de("div",{class:"design-canvas-container",ref_key:"elRef",ref:o},[Me(ze,{onCanvasCreated:i,id:"1"})],512))}});const ht=je(dt,[["__scopeId","data-v-461619e1"]]),gt=fe({__name:"DesignView",setup(e){return(t,n)=>(ce(),de("main",null,[Me(ht)]))}});export{gt as default};
