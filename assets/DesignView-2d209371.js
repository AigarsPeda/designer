import{f as y,d as ie,u as we,b as ye,r as A,e as je,o as le,c as se,a as De,_ as Ce,w as $e,g as ke}from"./index-1c801617.js";const xe=e=>{if(!e){console.error("makeAllObjCanvasUnselectable: canvas is null");return}e.selection=!1,e.discardActiveObject(),e.forEachObject(t=>{t.setOptions({evented:!1,selectable:!1,hasControls:!1,hasRotatingPoint:!1})})},Te=e=>{if(!e.length)return"";const t=e.reduce((o,[n,i],s,l)=>{const[r,h]=l[(s+1)%l.length];return o.push(n,i,(n+r)/2,(i+h)/2),o},["M",...e[0],"Q"]);return t.push("Z"),t.join(" ")};function de(e,t,o,n=i=>i){return e*n(.5-t*(.5-o))}function Ae(e){return[-e[0],-e[1]]}function w(e,t){return[e[0]+t[0],e[1]+t[1]]}function _(e,t){return[e[0]-t[0],e[1]-t[1]]}function b(e,t){return[e[0]*t,e[1]*t]}function Re(e,t){return[e[0]/t,e[1]/t]}function I(e){return[e[1],-e[0]]}function pe(e,t){return e[0]*t[0]+e[1]*t[1]}function Be(e,t){return e[0]===t[0]&&e[1]===t[1]}function ze(e){return Math.hypot(e[0],e[1])}function Fe(e){return e[0]*e[0]+e[1]*e[1]}function ge(e,t){return Fe(_(e,t))}function Se(e){return Re(e,ze(e))}function Ie(e,t){return Math.hypot(e[1]-t[1],e[0]-t[0])}function L(e,t,o){let n=Math.sin(o),i=Math.cos(o),s=e[0]-t[0],l=e[1]-t[1],r=s*i-l*n,h=s*n+l*i;return[r+t[0],h+t[1]]}function re(e,t,o){return w(e,b(_(t,e),o))}function ae(e,t,o){return w(e,b(t,o))}var{min:$,PI:Le}=Math,me=.275,W=Le+1e-4;function We(e,t={}){let{size:o=16,smoothing:n=.5,thinning:i=.5,simulatePressure:s=!0,easing:l=u=>u,start:r={},end:h={},last:m=!1}=t,{cap:k=!0,easing:x=u=>u*(2-u)}=r,{cap:X=!0,easing:g=u=>--u*u*u+1}=h;if(e.length===0||o<=0)return[];let p=e[e.length-1].runningLength,C=r.taper===!1?0:r.taper===!0?Math.max(o,p):r.taper,R=h.taper===!1?0:h.taper===!0?Math.max(o,p):h.taper,ue=Math.pow(o*n,2),B=[],D=[],q=e.slice(0,10).reduce((u,d)=>{let f=d.pressure;if(s){let c=$(1,d.distance/o),v=$(1,1-c);f=$(1,u+(v-u)*(c*me))}return(u+f)/2},e[0].pressure),a=de(o,i,e[e.length-1].pressure,l),N,J=e[0].vector,z=e[0].point,V=z,M=z,j=V,K=!1;for(let u=0;u<e.length;u++){let{pressure:d}=e[u],{point:f,vector:c,distance:v,runningLength:F}=e[u];if(u<e.length-1&&p-F<3)continue;if(i){if(s){let P=$(1,v/o),te=$(1,1-P);d=$(1,q+(te-q)*(P*me))}a=de(o,i,d,l)}else a=o/2;N===void 0&&(N=a);let Oe=F<C?x(F/C):1,Pe=p-F<R?g((p-F)/R):1;a=Math.max(.01,a*Math.min(Oe,Pe));let fe=(u<e.length-1?e[u+1]:e[u]).vector,ee=u<e.length-1?pe(c,fe):1,Me=pe(c,J)<0&&!K,ce=ee!==null&&ee<0;if(Me||ce){let P=b(I(J),a);for(let te=1/13,G=0;G<=1;G+=te)M=L(_(f,P),f,W*G),B.push(M),j=L(w(f,P),f,W*-G),D.push(j);z=M,V=j,ce&&(K=!0);continue}if(K=!1,u===e.length-1){let P=b(I(c),a);B.push(_(f,P)),D.push(w(f,P));continue}let he=b(I(re(fe,c,ee)),a);M=_(f,he),(u<=1||ge(z,M)>ue)&&(B.push(M),z=M),j=w(f,he),(u<=1||ge(V,j)>ue)&&(D.push(j),V=j),q=d,J=c}let S=e[0].point.slice(0,2),O=e.length>1?e[e.length-1].point.slice(0,2):w(e[0].point,[1,1]),Q=[],E=[];if(e.length===1){if(!(C||R)||m){let u=ae(S,Se(I(_(S,O))),-(N||a)),d=[];for(let f=1/13,c=f;c<=1;c+=f)d.push(L(u,S,W*2*c));return d}}else{if(!(C||R&&e.length===1))if(k)for(let d=1/13,f=d;f<=1;f+=d){let c=L(D[0],S,W*f);Q.push(c)}else{let d=_(B[0],D[0]),f=b(d,.5),c=b(d,.51);Q.push(_(S,f),_(S,c),w(S,c),w(S,f))}let u=I(Ae(e[e.length-1].vector));if(R||C&&e.length===1)E.push(O);else if(X){let d=ae(O,u,a);for(let f=1/29,c=f;c<1;c+=f)E.push(L(d,O,W*3*c))}else E.push(w(O,b(u,a)),w(O,b(u,a*.99)),_(O,b(u,a*.99)),_(O,b(u,a)))}return B.concat(E,D.reverse(),Q)}function Ye(e,t={}){var o;let{streamline:n=.5,size:i=16,last:s=!1}=t;if(e.length===0)return[];let l=.15+(1-n)*.85,r=Array.isArray(e[0])?e:e.map(({x:g,y:p,pressure:C=.5})=>[g,p,C]);if(r.length===2){let g=r[1];r=r.slice(0,-1);for(let p=1;p<5;p++)r.push(re(r[0],g,p/4))}r.length===1&&(r=[...r,[...w(r[0],[1,1]),...r[0].slice(2)]]);let h=[{point:[r[0][0],r[0][1]],pressure:r[0][2]>=0?r[0][2]:.25,vector:[1,1],distance:0,runningLength:0}],m=!1,k=0,x=h[0],X=r.length-1;for(let g=1;g<r.length;g++){let p=s&&g===X?r[g].slice(0,2):re(x.point,r[g],l);if(Be(x.point,p))continue;let C=Ie(p,x.point);if(k+=C,g<X&&!m){if(k<i)continue;m=!0}x={point:p,pressure:r[g][2]>=0?r[g][2]:.5,vector:Se(_(x.point,p)),distance:C,runningLength:k},h.push(x)}return h[0].vector=((o=h[1])==null?void 0:o.vector)||[0,0],h}function Xe(e,t={}){return We(Ye(e,t),t)}var Ve=Xe;const _e="drawnObjects";let H=!1,oe=[[0,0]],T=null;const Ee=({canvas:e,drawingMode:t})=>{if(!e){console.error("drawStrokeOnCanvas: canvas is null");return}e==null||e.off("mouse:up"),e==null||e.off("mouse:move"),e==null||e.off("mouse:down"),e.on("mouse:down",o=>{H=!0,T=null;const n=e.getPointer(o.e);oe=[[n.x,n.y]]}),e.on("mouse:move",o=>{if(!H)return;e.discardActiveObject();const n=e.getPointer(o.e);oe.push([n.x,n.y]);const i=Ve(oe,{size:t.size,thinning:t.thinning,smoothing:t.smoothing,streamline:t.streamline,easing(l){return l=Math.max(0,Math.min(1,l)),l*l*(3-2*l)}}),s=Te(i);y.fabric.loadSVGFromString(`<svg>
         <path fill="${t.stroke}" d="${s}" />
      </svg>`,l=>{const r=new y.fabric.Group(l,{id:_e,selectable:!1,hasRotatingPoint:!1});T=r,e.add(r)})}),e.on("mouse:up",o=>{if(!H)return;const i=e.getObjects().filter(s=>(s==null?void 0:s.id)===_e);if(i.length>0&&T){for(let s=0;s<i.length;s++)e.remove(i[s]);T.setOptions({id:"",selectable:!0,hasRotatingPoint:!0}),T.bringForward(!0),e.add(T),e.renderAll()}xe(e),H=!1})},Ge=(e,t)=>{if(e)return setTimeout(()=>e.requestRenderAll(),t)},He=({canvas:e,backgroundColor:t})=>{e&&e.setBackgroundColor(t,()=>Ge(e,0))};let U=0,Z=0,ne=!1;const Ue=({canvas:e})=>{e&&(e==null||e.off("mouse:up"),e==null||e.off("mouse:move"),e==null||e.off("mouse:down"),e.on("mouse:down",t=>{var o,n,i;if(ne=!0,t&&t.e&&t.e.type==="touchstart"){const s=t.e;U=(o=s==null?void 0:s.changedTouches[0])==null?void 0:o.clientX,Z=(n=s==null?void 0:s.changedTouches[0])==null?void 0:n.clientY}(i=t.target)==null||i.setOptions({opacity:.5})}),e.on("mouse:move",t=>{if(!(!ne||!t||!t.e||t.target)){if(t.e.type==="mousemove"){const o=new y.fabric.Point(t.e.movementX,t.e.movementY);e.relativePan(o)}if(t.e.type==="touchmove"){const o=t.e,n=o==null?void 0:o.touches[0];if(!n)return;const i=.9;let s=(n.clientX-U)*i,l=(n.clientY-Z)*i;U=n.clientX,Z=n.clientY;const r=new y.fabric.Point(s,l);e.relativePan(r)}}}),e.on("mouse:up",t=>{var o;ne=!1,(o=t.target)==null||o.setOptions({opacity:1}),U=0,Z=0}))},Ze=({canvas:e,containerRef:t})=>{const o=(t==null?void 0:t.offsetWidth)||500,n=(t==null?void 0:t.offsetHeight)||500;e==null||e.setDimensions({width:o,height:n})},qe=({canvas:e})=>{e.on("mouse:wheel",t=>{const o=t.e.deltaY;let n=e.getZoom();n*=.999**o,n>20&&(n=20),n<.01&&(n=.01),e.zoomToPoint({x:t.e.offsetX,y:t.e.offsetY},n),t.e.preventDefault(),t.e.stopPropagation()})},Ne=e=>{e==null||e.off("mouse:up"),e==null||e.off("mouse:move"),e==null||e.off("mouse:down")},Y=25,Je=.5,Ke="fill:#64748b;stroke:#64748b;stroke-width:0.5;",Qe=[[Y,0],[0,0],[Y,Y],[0,Y]],ve=({size:e=Y,radius:t=Je,circleStyle:o=Ke,circlePositions:n=Qe})=>`<svg width="${e/2}" height="${e/2}" viewBox="0 0 ${e/2} ${e/2}" version="1.1" xmlns="http://www.w3.org/2000/svg"><defs/><g>
    ${n.map(([i,s])=>`<circle style="${o}" cx="${i}" cy="${s}" r="${t}"/>`).join(`
`)}
    </g></svg>`,et=({svgString:e})=>`data:image/svg+xml;utf8,${encodeURIComponent(e)}`,tt=()=>new y.fabric.Pattern({source:et({svgString:ve({})}),repeat:"repeat"}),ot=ie({__name:"FabricCanvas",props:{id:{}},emits:["mouse:dblclick","canvas-created"],setup(e,{emit:t}){we(),ye();const o=A(null),n=A(null),i=A({width:0,height:0}),s=A(null);return je(()=>{var r,h,m,k;const l=new y.fabric.Canvas(s.value,{width:((r=n.value)==null?void 0:r.offsetWidth)||500,height:((h=n.value)==null?void 0:h.offsetHeight)||500});l&&(o.value=l,t("canvas-created",l),l.on("mouse:dblclick",()=>{t("mouse:dblclick")}),i.value={width:((m=n.value)==null?void 0:m.offsetWidth)||500,height:((k=n.value)==null?void 0:k.offsetHeight)||500},qe({canvas:l}),window.addEventListener("resize",()=>{Ze({canvas:l,containerRef:n.value})}))}),(l,r)=>(le(),se("div",{class:"container",ref_key:"containerRef",ref:n},[De("canvas",{id:"canvas",ref_key:"canvasReference",ref:s,width:500,height:500},null,512)],512))}});const nt=Ce(ot,[["__scopeId","data-v-e56d0c65"]]),rt=({canvas:e})=>{e==null||e.off("mouse:up"),e==null||e.off("mouse:move"),e==null||e.off("mouse:down"),e==null||e.on("mouse:down",t=>{var n;console.log("mouse:down",t),console.log("has target",e==null?void 0:e.findTarget(t.e,!0));const o=((n=e==null?void 0:e.findTarget(t.e,!0))==null?void 0:n.type)||"";console.log("targetType",o)})},be=e=>e==="drawing"||e==="panning",it=e=>{if(!e){console.error("makeAllObjCanvasSelectable: canvas is null");return}e.selection=!0,e==null||e.forEachObject(t=>{t.setOptions({evented:!0,selectable:!0,hasControls:!0,hasRotatingPoint:!0})})},lt=ie({__name:"MainDesign",setup(e){const t=we(),o=ye(),n=A(null),i=A(null),s=l=>{i.value=l;const r=l.getCenter();new y.fabric.Circle({radius:20,fill:"#4f46e5",top:r.top+100,left:r.left+100}),new y.fabric.Triangle({width:60,height:70,fill:"#c026d3",top:r.top+50,left:r.left+50}),new y.fabric.IText("Test text",{fontSize:22,top:r.top,left:r.left,hasControls:!0,fontStyle:"normal",fontWeight:"normal",fontFamily:"Helvetica"}),new y.fabric.Line([80,10,200,150],{stroke:"#374151"}),new y.fabric.Polyline([{x:80,y:10},{x:200,y:150},{x:500,y:250}],{stroke:"#ea580c",fill:"transparent",strokeWidth:5,strokeLineCap:"round",strokeLineJoin:"round"}),console.log("handleCreated --->",l)};return $e([t,o],l=>{const{getDrawingMode:r}=l[1],{getIsDotBackground:h,getCanvasMode:m}=l[0];switch(console.log("getCanvasMode --->",m),be(m)&&xe(i.value),be(m)||it(i.value),m){case"drawing":Ee({canvas:i.value,drawingMode:r});break;case"panning":Ue({canvas:i.value});break;case"mainMenu":rt({canvas:i.value});break;default:Ne(i.value);break}He({canvas:i.value,backgroundColor:h?tt():"transparent"})}),(l,r)=>(le(),se("div",{class:"design-canvas-container",ref_key:"elRef",ref:n},[ke(nt,{onCanvasCreated:s,id:"1"})],512))}});const st=Ce(lt,[["__scopeId","data-v-5054d42c"]]),ft=ie({__name:"DesignView",setup(e){return(t,o)=>(le(),se("main",null,[ke(st)]))}});export{ft as default};
