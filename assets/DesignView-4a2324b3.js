import{d as ce,r as z,b as Oe,f as B,o as ue,c as de,a as Be,_ as Me,e as Le,g as Re,h as ze,u as Ie,i as We,w as Ye,j as Se,k as Fe}from"./index-3c908a20.js";const Xe=({canvas:e,containerRef:t})=>{const n=(t==null?void 0:t.offsetWidth)||500,o=(t==null?void 0:t.offsetHeight)||500;e==null||e.setDimensions({width:n,height:o})},Ee=({canvas:e})=>{e.on("mouse:wheel",t=>{const n=t.e.deltaY;let o=e.getZoom();o*=.999**n,o>20&&(o=20),o<.01&&(o=.01),e.zoomToPoint({x:t.e.offsetX,y:t.e.offsetY},o),t.e.preventDefault(),t.e.stopPropagation()})},Te=ce({__name:"FabricCanvas",props:{id:{}},emits:["canvas-created","mouse-down","mouse-dblclick","selection-created","selection-cleared","selection-updated"],setup(e,{emit:t}){const n=z(null),o=z(null),s=z({width:0,height:0}),i=z(null);return Oe(()=>{var r,g,k,y;const a=new B.fabric.Canvas(i.value,{width:((r=o.value)==null?void 0:r.offsetWidth)||500,height:((g=o.value)==null?void 0:g.offsetHeight)||500});a&&(n.value=a,t("canvas-created",a),a.on("selection:created",l=>{t("selection-created",l)}),a.on("selection:updated",l=>{t("selection-updated",l)}),a.on("selection:cleared",l=>{t("selection-cleared",l)}),a.on("mouse:dblclick",l=>{t("mouse-dblclick",l)}),a.on("mouse:down:before",l=>{t("mouse-down",l)}),s.value={width:((k=o.value)==null?void 0:k.offsetWidth)||500,height:((y=o.value)==null?void 0:y.offsetHeight)||500},Ee({canvas:a}),window.addEventListener("resize",()=>{Xe({canvas:a,containerRef:o.value})}))}),(a,r)=>(ue(),de("div",{class:"container",ref_key:"containerRef",ref:o},[Be("canvas",{id:"canvas",ref_key:"canvasReference",ref:i,width:500,height:500},null,512)],512))}});const Ue=Me(Te,[["__scopeId","data-v-e5eaa40a"]]),qe=e=>{const t=z(null),n=()=>{t.value&&window.addEventListener("keydown",t.value)},o=()=>{t.value&&window.removeEventListener("keydown",t.value)};return Oe(()=>{t.value=e}),Le(()=>{o()}),{addListener:n,removeListener:o}},He=(e,t)=>{if(e.key==="Backspace"){const n=t.getActiveObject();if(!n)return;t.remove(n)}},xe=e=>{if(!e){console.error("makeAllObjCanvasUnselectable: canvas is null");return}e.selection=!1,e.discardActiveObject(),e.forEachObject(t=>{t.setOptions({evented:!1,selectable:!1,hasControls:!1,hasRotatingPoint:!1})})},be=e=>{e==null||e.off("mouse:up"),e==null||e.off("mouse:down"),e==null||e.off("mouse:move")},$e=e=>{if(!e.length)return"";const t=e.reduce((n,[o,s],i,a)=>{const[r,g]=a[(i+1)%a.length];return n.push(o,s,(o+r)/2,(s+g)/2),n},["M",...e[0],"Q"]);return t.push("Z"),t.join(" ")},fe=()=>`id-${Math.random().toString(16).slice(2)}`;function me(e,t,n,o=s=>s){return e*o(.5-t*(.5-n))}function Ve(e){return[-e[0],-e[1]]}function w(e,t){return[e[0]+t[0],e[1]+t[1]]}function _(e,t){return[e[0]-t[0],e[1]-t[1]]}function C(e,t){return[e[0]*t,e[1]*t]}function Ze(e,t){return[e[0]/t,e[1]/t]}function F(e){return[e[1],-e[0]]}function ve(e,t){return e[0]*t[0]+e[1]*t[1]}function Ge(e,t){return e[0]===t[0]&&e[1]===t[1]}function Ke(e){return Math.hypot(e[0],e[1])}function Ne(e){return e[0]*e[0]+e[1]*e[1]}function _e(e,t){return Ne(_(e,t))}function je(e){return Ze(e,Ke(e))}function Qe(e,t){return Math.hypot(e[1]-t[1],e[0]-t[0])}function X(e,t,n){let o=Math.sin(n),s=Math.cos(n),i=e[0]-t[0],a=e[1]-t[1],r=i*s-a*o,g=i*o+a*s;return[r+t[0],g+t[1]]}function ae(e,t,n){return w(e,C(_(t,e),n))}function Ce(e,t,n){return w(e,C(t,n))}var{min:L,PI:Je}=Math,we=.275,E=Je+1e-4;function et(e,t={}){let{size:n=16,smoothing:o=.5,thinning:s=.5,simulatePressure:i=!0,easing:a=c=>c,start:r={},end:g={},last:k=!1}=t,{cap:y=!0,easing:l=c=>c*(2-c)}=r,{cap:m=!0,easing:u=c=>--c*c*c+1}=g;if(e.length===0||n<=0)return[];let f=e[e.length-1].runningLength,b=r.taper===!1?0:r.taper===!0?Math.max(n,f):r.taper,O=g.taper===!1?0:g.taper===!0?Math.max(n,f):g.taper,I=Math.pow(n*o,2),M=[],P=[],N=e.slice(0,10).reduce((c,p)=>{let d=p.pressure;if(i){let h=L(1,p.distance/n),ne=L(1,1-h);d=L(1,c+(ne-c)*(h*we))}return(c+d)/2},e[0].pressure),v=me(n,s,e[e.length-1].pressure,a),Q,J=e[0].vector,W=e[0].point,q=W,D=W,A=q,ee=!1;for(let c=0;c<e.length;c++){let{pressure:p}=e[c],{point:d,vector:h,distance:ne,runningLength:Y}=e[c];if(c<e.length-1&&f-Y<3)continue;if(s){if(i){let j=L(1,ne/n),se=L(1,1-j);p=L(1,N+(se-N)*(j*we))}v=me(n,s,p,a)}else v=n/2;Q===void 0&&(Q=v);let Pe=Y<b?l(Y/b):1,De=f-Y<O?u((f-Y)/O):1;v=Math.max(.01,v*Math.min(Pe,De));let he=(c<e.length-1?e[c+1]:e[c]).vector,oe=c<e.length-1?ve(h,he):1,Ae=ve(h,J)<0&&!ee,ge=oe!==null&&oe<0;if(Ae||ge){let j=C(F(J),v);for(let se=1/13,$=0;$<=1;$+=se)D=X(_(d,j),d,E*$),M.push(D),A=X(w(d,j),d,E*-$),P.push(A);W=D,q=A,ge&&(ee=!0);continue}if(ee=!1,c===e.length-1){let j=C(F(h),v);M.push(_(d,j)),P.push(w(d,j));continue}let pe=C(F(ae(he,h,oe)),v);D=_(d,pe),(c<=1||_e(W,D)>I)&&(M.push(D),W=D),A=w(d,pe),(c<=1||_e(q,A)>I)&&(P.push(A),q=A),N=p,J=h}let S=e[0].point.slice(0,2),x=e.length>1?e[e.length-1].point.slice(0,2):w(e[0].point,[1,1]),te=[],H=[];if(e.length===1){if(!(b||O)||k){let c=Ce(S,je(F(_(S,x))),-(Q||v)),p=[];for(let d=1/13,h=d;h<=1;h+=d)p.push(X(c,S,E*2*h));return p}}else{if(!(b||O&&e.length===1))if(y)for(let p=1/13,d=p;d<=1;d+=p){let h=X(P[0],S,E*d);te.push(h)}else{let p=_(M[0],P[0]),d=C(p,.5),h=C(p,.51);te.push(_(S,d),_(S,h),w(S,h),w(S,d))}let c=F(Ve(e[e.length-1].vector));if(O||b&&e.length===1)H.push(x);else if(m){let p=Ce(x,c,v);for(let d=1/29,h=d;h<1;h+=d)H.push(X(p,x,E*3*h))}else H.push(w(x,C(c,v)),w(x,C(c,v*.99)),_(x,C(c,v*.99)),_(x,C(c,v)))}return M.concat(H,P.reverse(),te)}function tt(e,t={}){var n;let{streamline:o=.5,size:s=16,last:i=!1}=t;if(e.length===0)return[];let a=.15+(1-o)*.85,r=Array.isArray(e[0])?e:e.map(({x:u,y:f,pressure:b=.5})=>[u,f,b]);if(r.length===2){let u=r[1];r=r.slice(0,-1);for(let f=1;f<5;f++)r.push(ae(r[0],u,f/4))}r.length===1&&(r=[...r,[...w(r[0],[1,1]),...r[0].slice(2)]]);let g=[{point:[r[0][0],r[0][1]],pressure:r[0][2]>=0?r[0][2]:.25,vector:[1,1],distance:0,runningLength:0}],k=!1,y=0,l=g[0],m=r.length-1;for(let u=1;u<r.length;u++){let f=i&&u===m?r[u].slice(0,2):ae(l.point,r[u],a);if(Ge(l.point,f))continue;let b=Qe(f,l.point);if(y+=b,u<m&&!k){if(y<s)continue;k=!0}l={point:f,pressure:r[u][2]>=0?r[u][2]:.5,vector:je(_(l.point,f)),distance:b,runningLength:y},g.push(l)}return g[0].vector=((n=g[1])==null?void 0:n.vector)||[0,0],g}function nt(e,t={}){return et(tt(e,t),t)}var ot=nt;const ke="drawnObjects";let V=!1,re=[[0,0]],R=null;const st=({canvas:e,drawingSettings:t})=>{if(!e){console.error("drawStrokeOnCanvas: canvas is null");return}e.on("mouse:down",n=>{V=!0,R=null;const o=e.getPointer(n.e);re=[[o.x,o.y]]}),e.on("mouse:move",n=>{if(!V)return;e.discardActiveObject();const o=e.getPointer(n.e);re.push([o.x,o.y]);const s=ot(re,{size:t.size,thinning:t.thinning,smoothing:t.smoothing,streamline:t.streamline,easing(a){return a=Math.max(0,Math.min(1,a)),a*a*(3-2*a)}}),i=$e(s);B.fabric.loadSVGFromString(`<svg>
         <path fill="${t.stroke}" d="${i}" />
      </svg>`,a=>{const r=new B.fabric.Group(a,{id:ke,selectable:!1,hasRotatingPoint:!1});R=r,e.add(r)})}),e.on("mouse:up",n=>{if(!V)return;const s=e.getObjects().filter(i=>(i==null?void 0:i.id)===ke);if(s.length>0&&R){for(let i=0;i<s.length;i++)e.remove(s[i]);R.setOptions({selectable:!0,id:fe(),hasRotatingPoint:!0}),R.bringForward(!0),e.add(R),e.renderAll()}xe(e),V=!1})},rt=(e,t)=>{if(e)return setTimeout(()=>e.requestRenderAll(),t)},it=({canvas:e,backgroundColor:t})=>{e&&e.setBackgroundColor(t,()=>rt(e,0))};let Z=0,G=0,ie=!1;const lt=({canvas:e})=>{e&&(e.on("mouse:down",t=>{var n,o,s;if(ie=!0,t&&t.e&&t.e.type==="touchstart"){const i=t.e;Z=(n=i==null?void 0:i.changedTouches[0])==null?void 0:n.clientX,G=(o=i==null?void 0:i.changedTouches[0])==null?void 0:o.clientY}(s=t.target)==null||s.setOptions({opacity:.5})}),e.on("mouse:move",t=>{if(!(!ie||!t||!t.e||t.target)){if(t.e.type==="mousemove"){const n=new B.fabric.Point(t.e.movementX,t.e.movementY);e.relativePan(n)}if(t.e.type==="touchmove"){const n=t.e,o=n==null?void 0:n.touches[0];if(!o)return;const s=.9;let i=(o.clientX-Z)*s,a=(o.clientY-G)*s;Z=o.clientX,G=o.clientY;const r=new B.fabric.Point(i,a);e.relativePan(r)}}}),e.on("mouse:up",t=>{var n;ie=!1,(n=t.target)==null||n.setOptions({opacity:1}),Z=0,G=0}))},at=Re();let K="",T=0,U=0,le=!1;const ct=({canvas:e,squareModeSettings:t})=>{e&&(e.on("mouse:down",n=>{le=!0;const o=e.getPointer(n.e);T=o.x,U=o.y;const s=new B.fabric.Rect({angle:0,top:U,left:T,evented:!1,originY:"top",originX:"left",selectable:!1,hasRotatingPoint:!1,width:o.x-T,height:o.y-U,rx:t.rx,ry:t.ry,stroke:t.stroke,strokeWidth:t.strokeWidth,fill:ze({pasterns:at,stroke:t.stroke,background:t.background})});s.id=fe(),K=s.id,e.add(s),e.renderAll()}),e.on("mouse:move",n=>{if(!le||!K)return;const o=e.getPointer(n.e),i=e.getObjects().find(a=>a.id===K);i&&(T>o.x&&i.set({left:Math.abs(o.x)}),U>o.y&&i.set({top:Math.abs(o.y)}),i.setOptions({width:Math.abs(T-o.x),height:Math.abs(U-o.y)}),e.renderAll())}),e.on("mouse:up",n=>{le=!1;const s=e.getObjects().find(i=>i.id===K);s&&(e.remove(s),s.setOptions({evented:!0,selectable:!0,hasRotatingPoint:!0}),s.setCoords(),e.add(s),e.setActiveObject(s))}))},ye=e=>e==="drawing"||e==="panning",ut=e=>{if(!e){console.error("makeAllObjCanvasSelectable: canvas is null");return}e.selection=!0,e.forEachObject(t=>{t.setOptions({evented:!0,selectable:!0,hasControls:!0,hasRotatingPoint:!0})})},dt=ce({__name:"MainCanvas",setup(e){const t=Ie(),n=We(),o=z(null),{addListener:s,removeListener:i}=qe(l=>{const m=n.getSelectedCanvas;m&&He(l,m)}),a=l=>{var f,b,O,I,M;if(console.log("double click",l),l.target&&l.target.type==="i-text"){l.target.enterEditing(),i();return}const m={y:((f=l.pointer)==null?void 0:f.y)||0,x:(((b=l.pointer)==null?void 0:b.x)||0)-100},u=new B.fabric.IText("Double click to edit text",{fontSize:16,evented:!0,editable:!0,selected:!0,hasControls:!0,fontWeight:"bold",top:m.y,left:m.x,hasRotatingPoint:!0,fontFamily:"Montserrat"});u.id=fe(),u.bringToFront(),(O=n.getSelectedCanvas)==null||O.add(u),(I=n.getSelectedCanvas)==null||I.renderAll(),(M=n.getSelectedCanvas)==null||M.setActiveObject(u)},r=l=>{console.log("mouse down",l)},g=l=>{n.setSelectedCanvas({selectedCanvas:l})},k=l=>{console.log("selection",l),s(),t.setCanvasMode({canvasMode:"ObjContextMenu"})},y=l=>{console.log("selection cleared",l),t.setCanvasMode({canvasMode:"mainMenu"})};return Ye(()=>({getCanvasMode:t.getCanvasMode,getIsDotBackground:t.getIsDotBackground,getSelectedCanvas:n.getSelectedCanvas,getDrawingSettings:n.getDrawingSettings,getSquareModeSettings:n.getSquareModeSettings}),l=>{const{getCanvasMode:m,getSelectedCanvas:u,getDrawingSettings:f,getIsDotBackground:b,getSquareModeSettings:O}=l;switch(be(u),ye(m)&&xe(u),ye(m)||ut(u),t.getCanvasMode){case"drawing":st({canvas:u,drawingSettings:f});break;case"panning":lt({canvas:u});break;case"square":ct({canvas:u,squareModeSettings:O});break;default:be(u);break}it({canvas:u,backgroundColor:b?Fe({}):"transparent"})}),(l,m)=>(ue(),de("div",{class:"design-canvas-container",ref_key:"elRef",ref:o},[Se(Ue,{id:"1",onMouseDown:r,onMouseDblclick:a,onCanvasCreated:g,onSelectionCreated:k,onSelectionUpdated:k,onSelectionCleared:y})],512))}});const ft=Me(dt,[["__scopeId","data-v-fd3d6bba"]]),gt=ce({__name:"DesignView",setup(e){return(t,n)=>(ue(),de("main",null,[Se(ft)]))}});export{gt as default};
