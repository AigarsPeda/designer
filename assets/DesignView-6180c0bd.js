import{d as ce,u as Se,b as je,r as T,e as Pe,f as C,o as de,c as he,a as Ee,_ as De,g as We,h as Ye,i as Fe,w as Xe,j as Ie,k as He}from"./index-ade96036.js";const Ue=({canvas:e,containerRef:t})=>{const o=(t==null?void 0:t.offsetWidth)||500,n=(t==null?void 0:t.offsetHeight)||500;e==null||e.setDimensions({width:o,height:n})},$e=({canvas:e})=>{e.on("mouse:wheel",t=>{const o=t.e.deltaY;let n=e.getZoom();n*=.999**o,n>20&&(n=20),n<.01&&(n=.01),e.zoomToPoint({x:t.e.offsetX,y:t.e.offsetY},n),t.e.preventDefault(),t.e.stopPropagation()})},qe=ce({__name:"FabricCanvas",props:{id:{}},emits:["mouse:dblclick","canvas-created"],setup(e,{emit:t}){Se(),je();const o=T(null),n=T(null),r=T({width:0,height:0}),i=T(null);return Pe(()=>{var s,f,c,a;const l=new C.fabric.Canvas(i.value,{width:((s=n.value)==null?void 0:s.offsetWidth)||500,height:((f=n.value)==null?void 0:f.offsetHeight)||500});l&&(o.value=l,t("canvas-created",l),l.on("mouse:dblclick",()=>{t("mouse:dblclick")}),r.value={width:((c=n.value)==null?void 0:c.offsetWidth)||500,height:((a=n.value)==null?void 0:a.offsetHeight)||500},$e({canvas:l}),window.addEventListener("resize",()=>{Ue({canvas:l,containerRef:n.value})}))}),(l,s)=>(de(),he("div",{class:"container",ref_key:"containerRef",ref:n},[Ee("canvas",{id:"canvas",ref_key:"canvasReference",ref:i,width:500,height:500},null,512)],512))}});const Ve=De(qe,[["__scopeId","data-v-3428e730"]]),Ze=e=>{const t=T(null),o=()=>{t.value&&window.addEventListener("keydown",t.value)},n=()=>{t.value&&window.removeEventListener("keydown",t.value)};return Pe(()=>{t.value=e}),We(()=>{n()}),{addListener:o,removeListener:n}},Ae=e=>{if(!e){console.error("makeAllObjCanvasUnselectable: canvas is null");return}e.selection=!1,e.discardActiveObject(),e.forEachObject(t=>{t.setOptions({evented:!1,selectable:!1,hasControls:!1,hasRotatingPoint:!1})})},Ge=e=>{if(!e.length)return"";const t=e.reduce((o,[n,r],i,l)=>{const[s,f]=l[(i+1)%l.length];return o.push(n,r,(n+s)/2,(r+f)/2),o},["M",...e[0],"Q"]);return t.push("Z"),t.join(" ")},Le=()=>`id-${Math.random().toString(16).slice(2)}`;function be(e,t,o,n=r=>r){return e*n(.5-t*(.5-o))}function Ke(e){return[-e[0],-e[1]]}function y(e,t){return[e[0]+t[0],e[1]+t[1]]}function w(e,t){return[e[0]-t[0],e[1]-t[1]]}function k(e,t){return[e[0]*t,e[1]*t]}function Ne(e,t){return[e[0]/t,e[1]/t]}function W(e){return[e[1],-e[0]]}function _e(e,t){return e[0]*t[0]+e[1]*t[1]}function Je(e,t){return e[0]===t[0]&&e[1]===t[1]}function Qe(e){return Math.hypot(e[0],e[1])}function ve(e){return e[0]*e[0]+e[1]*e[1]}function we(e,t){return ve(w(e,t))}function Te(e){return Ne(e,Qe(e))}function et(e,t){return Math.hypot(e[1]-t[1],e[0]-t[0])}function Y(e,t,o){let n=Math.sin(o),r=Math.cos(o),i=e[0]-t[0],l=e[1]-t[1],s=i*r-l*n,f=i*n+l*r;return[s+t[0],f+t[1]]}function fe(e,t,o){return y(e,k(w(t,e),o))}function Ce(e,t,o){return y(e,k(t,o))}var{min:A,PI:tt}=Math,ke=.275,F=tt+1e-4;function ot(e,t={}){let{size:o=16,smoothing:n=.5,thinning:r=.5,simulatePressure:i=!0,easing:l=u=>u,start:s={},end:f={},last:c=!1}=t,{cap:a=!0,easing:O=u=>u*(2-u)}=s,{cap:D=!0,easing:m=u=>--u*u*u+1}=f;if(e.length===0||o<=0)return[];let h=e[e.length-1].runningLength,b=s.taper===!1?0:s.taper===!0?Math.max(o,h):s.taper,R=f.taper===!1?0:f.taper===!0?Math.max(o,h):f.taper,ae=Math.pow(o*n,2),z=[],I=[],J=e.slice(0,10).reduce((u,p)=>{let d=p.pressure;if(i){let g=A(1,p.distance/o),oe=A(1,1-g);d=A(1,u+(oe-u)*(g*ke))}return(u+d)/2},e[0].pressure),_=be(o,r,e[e.length-1].pressure,l),Q,v=e[0].vector,B=e[0].point,$=B,j=B,P=$,ee=!1;for(let u=0;u<e.length;u++){let{pressure:p}=e[u],{point:d,vector:g,distance:oe,runningLength:E}=e[u];if(u<e.length-1&&h-E<3)continue;if(r){if(i){let S=A(1,oe/o),re=A(1,1-S);p=A(1,J+(re-J)*(S*ke))}_=be(o,r,p,l)}else _=o/2;Q===void 0&&(Q=_);let Re=E<b?O(E/b):1,ze=h-E<R?m((h-E)/R):1;_=Math.max(.01,_*Math.min(Re,ze));let ge=(u<e.length-1?e[u+1]:e[u]).vector,ne=u<e.length-1?_e(g,ge):1,Be=_e(g,v)<0&&!ee,pe=ne!==null&&ne<0;if(Be||pe){let S=k(W(v),_);for(let re=1/13,V=0;V<=1;V+=re)j=Y(w(d,S),d,F*V),z.push(j),P=Y(y(d,S),d,F*-V),I.push(P);B=j,$=P,pe&&(ee=!0);continue}if(ee=!1,u===e.length-1){let S=k(W(g),_);z.push(w(d,S)),I.push(y(d,S));continue}let me=k(W(fe(ge,g,ne)),_);j=w(d,me),(u<=1||we(B,j)>ae)&&(z.push(j),B=j),P=y(d,me),(u<=1||we($,P)>ae)&&(I.push(P),$=P),J=p,v=g}let M=e[0].point.slice(0,2),x=e.length>1?e[e.length-1].point.slice(0,2):y(e[0].point,[1,1]),te=[],q=[];if(e.length===1){if(!(b||R)||c){let u=Ce(M,Te(W(w(M,x))),-(Q||_)),p=[];for(let d=1/13,g=d;g<=1;g+=d)p.push(Y(u,M,F*2*g));return p}}else{if(!(b||R&&e.length===1))if(a)for(let p=1/13,d=p;d<=1;d+=p){let g=Y(I[0],M,F*d);te.push(g)}else{let p=w(z[0],I[0]),d=k(p,.5),g=k(p,.51);te.push(w(M,d),w(M,g),y(M,g),y(M,d))}let u=W(Ke(e[e.length-1].vector));if(R||b&&e.length===1)q.push(x);else if(D){let p=Ce(x,u,_);for(let d=1/29,g=d;g<1;g+=d)q.push(Y(p,x,F*3*g))}else q.push(y(x,k(u,_)),y(x,k(u,_*.99)),w(x,k(u,_*.99)),w(x,k(u,_)))}return z.concat(q,I.reverse(),te)}function nt(e,t={}){var o;let{streamline:n=.5,size:r=16,last:i=!1}=t;if(e.length===0)return[];let l=.15+(1-n)*.85,s=Array.isArray(e[0])?e:e.map(({x:m,y:h,pressure:b=.5})=>[m,h,b]);if(s.length===2){let m=s[1];s=s.slice(0,-1);for(let h=1;h<5;h++)s.push(fe(s[0],m,h/4))}s.length===1&&(s=[...s,[...y(s[0],[1,1]),...s[0].slice(2)]]);let f=[{point:[s[0][0],s[0][1]],pressure:s[0][2]>=0?s[0][2]:.25,vector:[1,1],distance:0,runningLength:0}],c=!1,a=0,O=f[0],D=s.length-1;for(let m=1;m<s.length;m++){let h=i&&m===D?s[m].slice(0,2):fe(O.point,s[m],l);if(Je(O.point,h))continue;let b=et(h,O.point);if(a+=b,m<D&&!c){if(a<r)continue;c=!0}O={point:h,pressure:s[m][2]>=0?s[m][2]:.5,vector:Te(w(O.point,h)),distance:b,runningLength:a},f.push(O)}return f[0].vector=((o=f[1])==null?void 0:o.vector)||[0,0],f}function rt(e,t={}){return ot(nt(e,t),t)}var it=rt;const ye="drawnObjects";let Z=!1,ie=[[0,0]],L=null;const st=({canvas:e,drawingSettings:t})=>{if(!e){console.error("drawStrokeOnCanvas: canvas is null");return}e==null||e.off("mouse:up"),e==null||e.off("mouse:move"),e==null||e.off("mouse:down"),e.on("mouse:down",o=>{Z=!0,L=null;const n=e.getPointer(o.e);ie=[[n.x,n.y]]}),e.on("mouse:move",o=>{if(!Z)return;e.discardActiveObject();const n=e.getPointer(o.e);ie.push([n.x,n.y]);const r=it(ie,{size:t.size,thinning:t.thinning,smoothing:t.smoothing,streamline:t.streamline,easing(l){return l=Math.max(0,Math.min(1,l)),l*l*(3-2*l)}}),i=Ge(r);C.fabric.loadSVGFromString(`<svg>
         <path fill="${t.stroke}" d="${i}" />
      </svg>`,l=>{const s=new C.fabric.Group(l,{id:ye,selectable:!1,hasRotatingPoint:!1});L=s,e.add(s)})}),e.on("mouse:up",o=>{if(!Z)return;const r=e.getObjects().filter(i=>(i==null?void 0:i.id)===ye);if(r.length>0&&L){for(let i=0;i<r.length;i++)e.remove(r[i]);L.setOptions({selectable:!0,id:Le(),hasRotatingPoint:!0}),L.bringForward(!0),e.add(L),e.renderAll()}Ae(e),Z=!1})},lt=(e,t)=>{if(e)return setTimeout(()=>e.requestRenderAll(),t)},ut=({canvas:e,backgroundColor:t})=>{e&&e.setBackgroundColor(t,()=>lt(e,0))};let G=0,K=0,se=!1;const ft=({canvas:e})=>{e&&(e==null||e.off("mouse:up"),e==null||e.off("mouse:move"),e==null||e.off("mouse:down"),e.on("mouse:down",t=>{var o,n,r;if(se=!0,t&&t.e&&t.e.type==="touchstart"){const i=t.e;G=(o=i==null?void 0:i.changedTouches[0])==null?void 0:o.clientX,K=(n=i==null?void 0:i.changedTouches[0])==null?void 0:n.clientY}(r=t.target)==null||r.setOptions({opacity:.5})}),e.on("mouse:move",t=>{if(!(!se||!t||!t.e||t.target)){if(t.e.type==="mousemove"){const o=new C.fabric.Point(t.e.movementX,t.e.movementY);e.relativePan(o)}if(t.e.type==="touchmove"){const o=t.e,n=o==null?void 0:o.touches[0];if(!n)return;const r=.9;let i=(n.clientX-G)*r,l=(n.clientY-K)*r;G=n.clientX,K=n.clientY;const s=new C.fabric.Point(i,l);e.relativePan(s)}}}),e.on("mouse:up",t=>{var o;se=!1,(o=t.target)==null||o.setOptions({opacity:1}),G=0,K=0}))};let le=0;const Oe=200;let N=!1;const Me=({canvas:e,action:t})=>{e==null||e.off("mouse:up"),e==null||e.off("mouse:move"),e==null||e.off("mouse:down"),e==null||e.on("mouse:up",o=>{le&&clearTimeout(le),le=setTimeout(()=>{if(N)return;const r=e.getActiveObjects().map(i=>(i==null?void 0:i.id)||"no id");if(r.length>0){t("ObjContextMenu",r);return}t("mainMenu",[])},Oe)}),e==null||e.on("mouse:dblclick",o=>{const n=e.findTarget(o.e,!0);if(N)return;console.log("target",n);const r={x:((n==null?void 0:n.left)||0)+((n==null?void 0:n.width)||0)/2,y:((n==null?void 0:n.top)||0)+((n==null?void 0:n.height)||0)/2},i=new C.fabric.IText("Enter text here...",{fontSize:16,left:r.x,top:r.y,hasRotatingPoint:!0,editable:!0,selected:!0});e==null||e.add(i),i.enterEditing(),i.bringToFront(),e.discardActiveObject(),N=!0,console.log("dblclick",o),setTimeout(()=>{N=!1},Oe+100)})},ct=Ye();let X="",H=0,U=0,ue=!1;const dt=({canvas:e,endAction:t,squareModeSettings:o})=>{e&&(e==null||e.off("mouse:up"),e==null||e.off("mouse:move"),e==null||e.off("mouse:down"),e.on("mouse:down",n=>{ue=!0;const r=e.getPointer(n.e);H=r.x,U=r.y;const i=new C.fabric.Rect({angle:0,top:U,left:H,evented:!0,originY:"top",originX:"left",selectable:!0,hasRotatingPoint:!0,width:r.x-H,height:r.y-U,rx:o.rx,ry:o.ry,stroke:o.stroke,strokeWidth:o.strokeWidth,fill:Fe({pasterns:ct,stroke:o.stroke,background:o.background})});i.id=Le(),X=i.id,e.add(i)}),e.on("mouse:move",n=>{if(!ue||!X)return;const r=e.getPointer(n.e),l=e.getObjects().find(s=>s.id===X);l&&(H>r.x&&l.set({left:Math.abs(r.x)}),U>r.y&&l.set({top:Math.abs(r.y)}),l.setOptions({width:Math.abs(H-r.x),height:Math.abs(U-r.y)}),e.renderAll())}),e.on("mouse:up",n=>{ue=!1,t(X),X=""}))},xe=e=>e==="drawing"||e==="panning",ht=e=>{if(!e){console.error("makeAllObjCanvasSelectable: canvas is null");return}e.selection=!0,e.forEachObject(t=>{t.setOptions({evented:!0,selectable:!0,hasControls:!0,hasRotatingPoint:!0})})},at=e=>{e==null||e.off("mouse:up"),e==null||e.off("mouse:move"),e==null||e.off("mouse:down")},gt=ce({__name:"MainCanvas",setup(e){const t=Se(),o=je(),n=T(null),r=f=>{o.setSelectedCanvas({selectedCanvas:f});const c=f.getCenter();new C.fabric.Circle({radius:20,fill:"#4f46e5",top:c.top+100,left:c.left+100}),new C.fabric.Triangle({width:60,height:70,fill:"#c026d3",top:c.top+50,left:c.left+50}),new C.fabric.IText("Test text",{fontSize:22,top:c.top,left:c.left,hasControls:!0,fontStyle:"normal",fontWeight:"normal",fontFamily:"Helvetica"}),new C.fabric.Line([80,10,200,150],{stroke:"#374151"}),new C.fabric.Polyline([{x:80,y:10},{x:200,y:150},{x:500,y:250}],{stroke:"#ea580c",fill:"transparent",strokeWidth:5,strokeLineCap:"round",strokeLineJoin:"round"})},i=(f,c)=>{if(f.key==="Backspace"){const a=c.getActiveObject();if(!a)return;c.remove(a)}},{addListener:l,removeListener:s}=Ze(f=>{const c=o.getSelectedCanvas;c&&i(f,c)});return Xe(()=>({getCanvasMode:t.getCanvasMode,getIsDotBackground:t.getIsDotBackground,getSelectedCanvas:o.getSelectedCanvas,getDrawingSettings:o.getDrawingSettings,getSquareModeSettings:o.getSquareModeSettings}),f=>{const{getCanvasMode:c,getSelectedCanvas:a,getDrawingSettings:O,getIsDotBackground:D,getSquareModeSettings:m}=f;switch(xe(c)&&Ae(a),xe(c)||ht(a),t.getCanvasMode){case"drawing":st({canvas:a,drawingSettings:O});break;case"panning":ft({canvas:a});break;case"square":dt({canvas:a,squareModeSettings:m,endAction:h=>{t.setCanvasMode({canvasMode:"ObjContextMenu"}),o.setSelectedObjectIds({selectedObjectIds:[h]})}});break;case"mainMenu":Me({canvas:a,action:(h,b)=>{t.setCanvasMode({canvasMode:h}),o.setSelectedObjectIds({selectedObjectIds:b})}});break;case"ObjContextMenu":l(),Me({canvas:a,action:(h,b)=>{t.setCanvasMode({canvasMode:h}),o.setSelectedObjectIds({selectedObjectIds:b})}});break;default:at(a);break}ut({canvas:a,backgroundColor:D?He({}):"transparent"})}),(f,c)=>(de(),he("div",{class:"design-canvas-container",ref_key:"elRef",ref:n},[Ie(Ve,{onCanvasCreated:r,id:"1"})],512))}});const pt=De(gt,[["__scopeId","data-v-66a54653"]]),bt=ce({__name:"DesignView",setup(e){return(t,o)=>(de(),he("main",null,[Ie(pt)]))}});export{bt as default};
