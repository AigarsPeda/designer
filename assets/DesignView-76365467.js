import{f as C,d as ie,u as be,b as we,r as A,e as ve,o as se,c as le,a as Me,_ as Ce,w as je,g as ye}from"./index-48699592.js";const ke=e=>{if(!e){console.error("makeAllObjCanvasUnselectable: canvas is null");return}e.selection=!1,e.discardActiveObject(),e.forEachObject(t=>{t.setOptions({evented:!1,selectable:!1,hasControls:!1,hasRotatingPoint:!1})})},De=e=>{if(!e.length)return"";const t=e.reduce((n,[r,i],l,s)=>{const[o,a]=s[(l+1)%s.length];return n.push(r,i,(r+o)/2,(i+a)/2),n},["M",...e[0],"Q"]);return t.push("Z"),t.join(" ")};function he(e,t,n,r=i=>i){return e*r(.5-t*(.5-n))}function $e(e){return[-e[0],-e[1]]}function w(e,t){return[e[0]+t[0],e[1]+t[1]]}function m(e,t){return[e[0]-t[0],e[1]-t[1]]}function b(e,t){return[e[0]*t,e[1]*t]}function Ae(e,t){return[e[0]/t,e[1]/t]}function I(e){return[e[1],-e[0]]}function de(e,t){return e[0]*t[0]+e[1]*t[1]}function Re(e,t){return e[0]===t[0]&&e[1]===t[1]}function Be(e){return Math.hypot(e[0],e[1])}function ze(e){return e[0]*e[0]+e[1]*e[1]}function pe(e,t){return ze(m(e,t))}function xe(e){return Ae(e,Be(e))}function Fe(e,t){return Math.hypot(e[1]-t[1],e[0]-t[0])}function L(e,t,n){let r=Math.sin(n),i=Math.cos(n),l=e[0]-t[0],s=e[1]-t[1],o=l*i-s*r,a=l*r+s*i;return[o+t[0],a+t[1]]}function re(e,t,n){return w(e,b(m(t,e),n))}function ge(e,t,n){return w(e,b(t,n))}var{min:D,PI:Ie}=Math,me=.275,T=Ie+1e-4;function Le(e,t={}){let{size:n=16,smoothing:r=.5,thinning:i=.5,simulatePressure:l=!0,easing:s=u=>u,start:o={},end:a={},last:_=!1}=t,{cap:k=!0,easing:x=u=>u*(2-u)}=o,{cap:Y=!0,easing:p=u=>--u*u*u+1}=a;if(e.length===0||n<=0)return[];let d=e[e.length-1].runningLength,y=o.taper===!1?0:o.taper===!0?Math.max(n,d):o.taper,R=a.taper===!1?0:a.taper===!0?Math.max(n,d):a.taper,ue=Math.pow(n*r,2),B=[],j=[],Z=e.slice(0,10).reduce((u,h)=>{let c=h.pressure;if(l){let f=D(1,h.distance/n),Q=D(1,1-f);c=D(1,u+(Q-u)*(f*me))}return(u+c)/2},e[0].pressure),g=he(n,i,e[e.length-1].pressure,s),q,N=e[0].vector,z=e[0].point,X=z,v=z,M=X,J=!1;for(let u=0;u<e.length;u++){let{pressure:h}=e[u],{point:c,vector:f,distance:Q,runningLength:F}=e[u];if(u<e.length-1&&d-F<3)continue;if(i){if(l){let O=D(1,Q/n),te=D(1,1-O);h=D(1,Z+(te-Z)*(O*me))}g=he(n,i,h,s)}else g=n/2;q===void 0&&(q=g);let Se=F<y?x(F/y):1,Pe=d-F<R?p((d-F)/R):1;g=Math.max(.01,g*Math.min(Se,Pe));let ce=(u<e.length-1?e[u+1]:e[u]).vector,ee=u<e.length-1?de(f,ce):1,Oe=de(f,N)<0&&!J,fe=ee!==null&&ee<0;if(Oe||fe){let O=b(I(N),g);for(let te=1/13,E=0;E<=1;E+=te)v=L(m(c,O),c,T*E),B.push(v),M=L(w(c,O),c,T*-E),j.push(M);z=v,X=M,fe&&(J=!0);continue}if(J=!1,u===e.length-1){let O=b(I(f),g);B.push(m(c,O)),j.push(w(c,O));continue}let ae=b(I(re(ce,f,ee)),g);v=m(c,ae),(u<=1||pe(z,v)>ue)&&(B.push(v),z=v),M=w(c,ae),(u<=1||pe(X,M)>ue)&&(j.push(M),X=M),Z=h,N=f}let S=e[0].point.slice(0,2),P=e.length>1?e[e.length-1].point.slice(0,2):w(e[0].point,[1,1]),K=[],V=[];if(e.length===1){if(!(y||R)||_){let u=ge(S,xe(I(m(S,P))),-(q||g)),h=[];for(let c=1/13,f=c;f<=1;f+=c)h.push(L(u,S,T*2*f));return h}}else{if(!(y||R&&e.length===1))if(k)for(let h=1/13,c=h;c<=1;c+=h){let f=L(j[0],S,T*c);K.push(f)}else{let h=m(B[0],j[0]),c=b(h,.5),f=b(h,.51);K.push(m(S,c),m(S,f),w(S,f),w(S,c))}let u=I($e(e[e.length-1].vector));if(R||y&&e.length===1)V.push(P);else if(Y){let h=ge(P,u,g);for(let c=1/29,f=c;f<1;f+=c)V.push(L(h,P,T*3*f))}else V.push(w(P,b(u,g)),w(P,b(u,g*.99)),m(P,b(u,g*.99)),m(P,b(u,g)))}return B.concat(V,j.reverse(),K)}function Te(e,t={}){var n;let{streamline:r=.5,size:i=16,last:l=!1}=t;if(e.length===0)return[];let s=.15+(1-r)*.85,o=Array.isArray(e[0])?e:e.map(({x:p,y:d,pressure:y=.5})=>[p,d,y]);if(o.length===2){let p=o[1];o=o.slice(0,-1);for(let d=1;d<5;d++)o.push(re(o[0],p,d/4))}o.length===1&&(o=[...o,[...w(o[0],[1,1]),...o[0].slice(2)]]);let a=[{point:[o[0][0],o[0][1]],pressure:o[0][2]>=0?o[0][2]:.25,vector:[1,1],distance:0,runningLength:0}],_=!1,k=0,x=a[0],Y=o.length-1;for(let p=1;p<o.length;p++){let d=l&&p===Y?o[p].slice(0,2):re(x.point,o[p],s);if(Re(x.point,d))continue;let y=Fe(d,x.point);if(k+=y,p<Y&&!_){if(k<i)continue;_=!0}x={point:d,pressure:o[p][2]>=0?o[p][2]:.5,vector:xe(m(x.point,d)),distance:y,runningLength:k},a.push(x)}return a[0].vector=((n=a[1])==null?void 0:n.vector)||[0,0],a}function We(e,t={}){return Le(Te(e,t),t)}var Ye=We;const _e="drawnObjects";let G=!1,ne=[[0,0]],$=null;const Xe=({canvas:e,drawingMode:t})=>{if(!e){console.error("drawStrokeOnCanvas: canvas is null");return}e==null||e.off("mouse:up"),e==null||e.off("mouse:move"),e==null||e.off("mouse:down"),e.on("mouse:down",n=>{G=!0,$=null;const r=e.getPointer(n.e);ne=[[r.x,r.y]]}),e.on("mouse:move",n=>{if(!G)return;e.discardActiveObject();const r=e.getPointer(n.e);ne.push([r.x,r.y]);const i=Ye(ne,{size:t.size,thinning:t.thinning,smoothing:t.smoothing,streamline:t.streamline,easing(s){return s=Math.max(0,Math.min(1,s)),s*s*(3-2*s)}}),l=De(i);C.fabric.loadSVGFromString(`<svg>
         <path fill="${t.stroke}" d="${l}" />
      </svg>`,s=>{const o=new C.fabric.Group(s,{id:_e,selectable:!1,hasRotatingPoint:!1});$=o,e.add(o)})}),e.on("mouse:up",n=>{if(!G)return;const i=e.getObjects().filter(l=>(l==null?void 0:l.id)===_e);if(i.length>0&&$){for(let l=0;l<i.length;l++)e.remove(i[l]);$.setOptions({id:"",selectable:!0,hasRotatingPoint:!0}),$.bringForward(!0),e.add($),e.renderAll()}ke(e),G=!1})},Ve=(e,t)=>{if(e)return setTimeout(()=>e.requestRenderAll(),t)},Ee=({canvas:e,backgroundColor:t})=>{e&&e.setBackgroundColor(t,()=>Ve(e,0))};let H=0,U=0,oe=!1;const Ge=({canvas:e})=>{e&&(e==null||e.off("mouse:up"),e==null||e.off("mouse:move"),e==null||e.off("mouse:down"),e.on("mouse:down",t=>{var n,r,i;if(oe=!0,t&&t.e&&t.e.type==="touchstart"){const l=t.e;H=(n=l==null?void 0:l.changedTouches[0])==null?void 0:n.clientX,U=(r=l==null?void 0:l.changedTouches[0])==null?void 0:r.clientY}(i=t.target)==null||i.setOptions({opacity:.5})}),e.on("mouse:move",t=>{if(!(!oe||!t||!t.e||t.target)){if(t.e.type==="mousemove"){const n=new C.fabric.Point(t.e.movementX,t.e.movementY);e.relativePan(n)}if(t.e.type==="touchmove"){const n=t.e,r=n==null?void 0:n.touches[0];if(!r)return;const i=.9;let l=(r.clientX-H)*i,s=(r.clientY-U)*i;H=r.clientX,U=r.clientY;const o=new C.fabric.Point(l,s);e.relativePan(o)}}}),e.on("mouse:up",t=>{var n;oe=!1,(n=t.target)==null||n.setOptions({opacity:1}),H=0,U=0}))},He=({canvas:e,containerRef:t})=>{const n=(t==null?void 0:t.offsetWidth)||500,r=(t==null?void 0:t.offsetHeight)||500;e==null||e.setDimensions({width:n,height:r})},Ue=({canvas:e})=>{e.on("mouse:wheel",t=>{const n=t.e.deltaY;let r=e.getZoom();r*=.999**n,r>20&&(r=20),r<.01&&(r=.01),e.zoomToPoint({x:t.e.offsetX,y:t.e.offsetY},r),t.e.preventDefault(),t.e.stopPropagation()})},Ze=e=>{e==null||e.off("mouse:up"),e==null||e.off("mouse:move"),e==null||e.off("mouse:down")},W=25,qe=.5,Ne="fill:#64748b;stroke:#64748b;stroke-width:0.5;",Je=[[W,0],[0,0],[W,W],[0,W]],Ke=({size:e=W,radius:t=qe,circleStyle:n=Ne,circlePositions:r=Je})=>`<svg width="${e/2}" height="${e/2}" viewBox="0 0 ${e/2} ${e/2}" version="1.1" xmlns="http://www.w3.org/2000/svg"><defs/><g>
    ${r.map(([i,l])=>`<circle style="${n}" cx="${i}" cy="${l}" r="${t}"/>`).join(`
`)}
    </g></svg>`,Qe=({svgString:e})=>`data:image/svg+xml;utf8,${encodeURIComponent(e)}`,et=()=>new C.fabric.Pattern({source:Qe({svgString:Ke({})}),repeat:"repeat"}),tt=ie({__name:"FabricCanvas",props:{id:{}},emits:["mouse:dblclick","canvas-created"],setup(e,{emit:t}){be(),we();const n=A(null),r=A(null),i=A({width:0,height:0}),l=A(null);return ve(()=>{var o,a,_,k;const s=new C.fabric.Canvas(l.value,{width:((o=r.value)==null?void 0:o.offsetWidth)||500,height:((a=r.value)==null?void 0:a.offsetHeight)||500});s&&(n.value=s,t("canvas-created",s),s.on("mouse:dblclick",()=>{t("mouse:dblclick")}),i.value={width:((_=r.value)==null?void 0:_.offsetWidth)||500,height:((k=r.value)==null?void 0:k.offsetHeight)||500},Ue({canvas:s}),window.addEventListener("resize",()=>{He({canvas:s,containerRef:r.value})}))}),(s,o)=>(se(),le("div",{class:"container",ref_key:"containerRef",ref:r},[Me("canvas",{id:"canvas",ref_key:"canvasReference",ref:l,width:500,height:500},null,512)],512))}});const nt=Ce(tt,[["__scopeId","data-v-e56d0c65"]]),ot=e=>{if(!e){console.error("makeAllObjCanvasSelectable: canvas is null");return}e.selection=!0,e==null||e.forEachObject(t=>{t.setOptions({evented:!0,selectable:!0,hasControls:!0,hasRotatingPoint:!0})})},rt=ie({__name:"MainDesign",setup(e){const t=be(),n=we(),r=A(null),i=A(null),l=s=>{i.value=s;const o=s.getCenter();new C.fabric.Circle({radius:20,fill:"#4f46e5",top:o.top+100,left:o.left+100}),new C.fabric.Triangle({width:60,height:70,fill:"#c026d3",top:o.top+50,left:o.left+50}),new C.fabric.IText("Test text",{fontSize:22,top:o.top,left:o.left,hasControls:!0,fontStyle:"normal",fontWeight:"normal",fontFamily:"Helvetica"}),new C.fabric.Line([80,10,200,150],{stroke:"#374151"}),new C.fabric.Polyline([{x:80,y:10},{x:200,y:150},{x:500,y:250}],{stroke:"#ea580c",fill:"transparent",strokeWidth:5,strokeLineCap:"round",strokeLineJoin:"round"}),console.log("handleCreated --->",s)};return je([t,n],s=>{const{getDrawingMode:o}=s[1],{getIsDotBackground:a,getCanvasMode:_}=s[0];switch(_==="drawing"&&ke(i.value),_!=="drawing"&&ot(i.value),_){case"drawing":Xe({canvas:i.value,drawingMode:o});break;case"panning":Ge({canvas:i.value});break;default:Ze(i.value);break}Ee({canvas:i.value,backgroundColor:a?et():"transparent"})}),(s,o)=>(se(),le("div",{class:"design-canvas-container",ref_key:"elRef",ref:r},[ye(nt,{onCanvasCreated:l,id:"1"})],512))}});const it=Ce(rt,[["__scopeId","data-v-ea20e2d6"]]),lt=ie({__name:"DesignView",setup(e){return(t,n)=>(se(),le("main",null,[ye(it)]))}});export{lt as default};
