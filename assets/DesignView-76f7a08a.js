import{f as w,d as ie,u as we,b as Ce,r as W,e as je,o as se,c as le,a as De,_ as ke,w as $e,g as Se}from"./index-e55b3b56.js";const ye=e=>{if(!e){console.error("makeAllObjCanvasUnselectable: canvas is null");return}e.selection=!1,e.discardActiveObject(),e.forEachObject(t=>{t.setOptions({evented:!1,selectable:!1,hasControls:!1,hasRotatingPoint:!1})})},Ie=e=>{if(!e.length)return"";const t=e.reduce((n,[o,l],r,s)=>{const[i,c]=s[(r+1)%s.length];return n.push(o,l,(o+i)/2,(l+c)/2),n},["M",...e[0],"Q"]);return t.push("Z"),t.join(" ")},Ae=()=>`id-${Math.random().toString(16).slice(2)}`;function de(e,t,n,o=l=>l){return e*o(.5-t*(.5-n))}function Be(e){return[-e[0],-e[1]]}function b(e,t){return[e[0]+t[0],e[1]+t[1]]}function m(e,t){return[e[0]-t[0],e[1]-t[1]]}function _(e,t){return[e[0]*t,e[1]*t]}function Re(e,t){return[e[0]/t,e[1]/t]}function F(e){return[e[1],-e[0]]}function he(e,t){return e[0]*t[0]+e[1]*t[1]}function ze(e,t){return e[0]===t[0]&&e[1]===t[1]}function Fe(e){return Math.hypot(e[0],e[1])}function Le(e){return e[0]*e[0]+e[1]*e[1]}function ge(e,t){return Le(m(e,t))}function xe(e){return Re(e,Fe(e))}function Te(e,t){return Math.hypot(e[1]-t[1],e[0]-t[0])}function L(e,t,n){let o=Math.sin(n),l=Math.cos(n),r=e[0]-t[0],s=e[1]-t[1],i=r*l-s*o,c=r*o+s*l;return[i+t[0],c+t[1]]}function re(e,t,n){return b(e,_(m(t,e),n))}function pe(e,t,n){return b(e,_(t,n))}var{min:$,PI:We}=Math,me=.275,T=We+1e-4;function Ye(e,t={}){let{size:n=16,smoothing:o=.5,thinning:l=.5,simulatePressure:r=!0,easing:s=u=>u,start:i={},end:c={},last:y=!1}=t,{cap:C=!0,easing:k=u=>u*(2-u)}=i,{cap:v=!0,easing:g=u=>--u*u*u+1}=c;if(e.length===0||n<=0)return[];let h=e[e.length-1].runningLength,S=i.taper===!1?0:i.taper===!0?Math.max(n,h):i.taper,A=c.taper===!1?0:c.taper===!0?Math.max(n,h):c.taper,ue=Math.pow(n*o,2),B=[],D=[],Z=e.slice(0,10).reduce((u,d)=>{let f=d.pressure;if(r){let a=$(1,d.distance/n),Q=$(1,1-a);f=$(1,u+(Q-u)*(a*me))}return(u+f)/2},e[0].pressure),p=de(n,l,e[e.length-1].pressure,s),q,N=e[0].vector,R=e[0].point,X=R,P=R,j=X,J=!1;for(let u=0;u<e.length;u++){let{pressure:d}=e[u],{point:f,vector:a,distance:Q,runningLength:z}=e[u];if(u<e.length-1&&h-z<3)continue;if(l){if(r){let O=$(1,Q/n),te=$(1,1-O);d=$(1,Z+(te-Z)*(O*me))}p=de(n,l,d,s)}else p=n/2;q===void 0&&(q=p);let Me=z<S?k(z/S):1,Oe=h-z<A?g((h-z)/A):1;p=Math.max(.01,p*Math.min(Me,Oe));let ce=(u<e.length-1?e[u+1]:e[u]).vector,ee=u<e.length-1?he(a,ce):1,Pe=he(a,N)<0&&!J,fe=ee!==null&&ee<0;if(Pe||fe){let O=_(F(N),p);for(let te=1/13,V=0;V<=1;V+=te)P=L(m(f,O),f,T*V),B.push(P),j=L(b(f,O),f,T*-V),D.push(j);R=P,X=j,fe&&(J=!0);continue}if(J=!1,u===e.length-1){let O=_(F(a),p);B.push(m(f,O)),D.push(b(f,O));continue}let ae=_(F(re(ce,a,ee)),p);P=m(f,ae),(u<=1||ge(R,P)>ue)&&(B.push(P),R=P),j=b(f,ae),(u<=1||ge(X,j)>ue)&&(D.push(j),X=j),Z=d,N=a}let x=e[0].point.slice(0,2),M=e.length>1?e[e.length-1].point.slice(0,2):b(e[0].point,[1,1]),K=[],U=[];if(e.length===1){if(!(S||A)||y){let u=pe(x,xe(F(m(x,M))),-(q||p)),d=[];for(let f=1/13,a=f;a<=1;a+=f)d.push(L(u,x,T*2*a));return d}}else{if(!(S||A&&e.length===1))if(C)for(let d=1/13,f=d;f<=1;f+=d){let a=L(D[0],x,T*f);K.push(a)}else{let d=m(B[0],D[0]),f=_(d,.5),a=_(d,.51);K.push(m(x,f),m(x,a),b(x,a),b(x,f))}let u=F(Be(e[e.length-1].vector));if(A||S&&e.length===1)U.push(M);else if(v){let d=pe(M,u,p);for(let f=1/29,a=f;a<1;a+=f)U.push(L(d,M,T*3*a))}else U.push(b(M,_(u,p)),b(M,_(u,p*.99)),m(M,_(u,p*.99)),m(M,_(u,p)))}return B.concat(U,D.reverse(),K)}function ve(e,t={}){var n;let{streamline:o=.5,size:l=16,last:r=!1}=t;if(e.length===0)return[];let s=.15+(1-o)*.85,i=Array.isArray(e[0])?e:e.map(({x:g,y:h,pressure:S=.5})=>[g,h,S]);if(i.length===2){let g=i[1];i=i.slice(0,-1);for(let h=1;h<5;h++)i.push(re(i[0],g,h/4))}i.length===1&&(i=[...i,[...b(i[0],[1,1]),...i[0].slice(2)]]);let c=[{point:[i[0][0],i[0][1]],pressure:i[0][2]>=0?i[0][2]:.25,vector:[1,1],distance:0,runningLength:0}],y=!1,C=0,k=c[0],v=i.length-1;for(let g=1;g<i.length;g++){let h=r&&g===v?i[g].slice(0,2):re(k.point,i[g],s);if(ze(k.point,h))continue;let S=Te(h,k.point);if(C+=S,g<v&&!y){if(C<l)continue;y=!0}k={point:h,pressure:i[g][2]>=0?i[g][2]:.5,vector:xe(m(k.point,h)),distance:S,runningLength:C},c.push(k)}return c[0].vector=((n=c[1])==null?void 0:n.vector)||[0,0],c}function Xe(e,t={}){return Ye(ve(e,t),t)}var Ue=Xe;const _e="drawnObjects";let E=!1,ne=[[0,0]],I=null;const Ve=({canvas:e,drawingMode:t})=>{if(!e){console.error("drawStrokeOnCanvas: canvas is null");return}e==null||e.off("mouse:up"),e==null||e.off("mouse:move"),e==null||e.off("mouse:down"),e.on("mouse:down",n=>{E=!0,I=null;const o=e.getPointer(n.e);ne=[[o.x,o.y]]}),e.on("mouse:move",n=>{if(!E)return;e.discardActiveObject();const o=e.getPointer(n.e);ne.push([o.x,o.y]);const l=Ue(ne,{size:t.size,thinning:t.thinning,smoothing:t.smoothing,streamline:t.streamline,easing(s){return s=Math.max(0,Math.min(1,s)),s*s*(3-2*s)}}),r=Ie(l);w.fabric.loadSVGFromString(`<svg>
         <path fill="${t.stroke}" d="${r}" />
      </svg>`,s=>{const i=new w.fabric.Group(s,{id:_e,selectable:!1,hasRotatingPoint:!1});I=i,e.add(i)})}),e.on("mouse:up",n=>{if(!E)return;const l=e.getObjects().filter(r=>(r==null?void 0:r.id)===_e);if(l.length>0&&I){for(let r=0;r<l.length;r++)e.remove(l[r]);I.setOptions({selectable:!0,id:Ae(),hasRotatingPoint:!0}),I.bringForward(!0),e.add(I),e.renderAll()}ye(e),E=!1})},Ee=(e,t)=>{if(e)return setTimeout(()=>e.requestRenderAll(),t)},Ge=({canvas:e,backgroundColor:t})=>{e&&e.setBackgroundColor(t,()=>Ee(e,0))};let G=0,H=0,oe=!1;const He=({canvas:e})=>{e&&(e==null||e.off("mouse:up"),e==null||e.off("mouse:move"),e==null||e.off("mouse:down"),e.on("mouse:down",t=>{var n,o,l;if(oe=!0,t&&t.e&&t.e.type==="touchstart"){const r=t.e;G=(n=r==null?void 0:r.changedTouches[0])==null?void 0:n.clientX,H=(o=r==null?void 0:r.changedTouches[0])==null?void 0:o.clientY}(l=t.target)==null||l.setOptions({opacity:.5})}),e.on("mouse:move",t=>{if(!(!oe||!t||!t.e||t.target)){if(t.e.type==="mousemove"){const n=new w.fabric.Point(t.e.movementX,t.e.movementY);e.relativePan(n)}if(t.e.type==="touchmove"){const n=t.e,o=n==null?void 0:n.touches[0];if(!o)return;const l=.9;let r=(o.clientX-G)*l,s=(o.clientY-H)*l;G=o.clientX,H=o.clientY;const i=new w.fabric.Point(r,s);e.relativePan(i)}}}),e.on("mouse:up",t=>{var n;oe=!1,(n=t.target)==null||n.setOptions({opacity:1}),G=0,H=0}))},Ze=({canvas:e,containerRef:t})=>{const n=(t==null?void 0:t.offsetWidth)||500,o=(t==null?void 0:t.offsetHeight)||500;e==null||e.setDimensions({width:n,height:o})},qe=({canvas:e})=>{e.on("mouse:wheel",t=>{const n=t.e.deltaY;let o=e.getZoom();o*=.999**n,o>20&&(o=20),o<.01&&(o=.01),e.zoomToPoint({x:t.e.offsetX,y:t.e.offsetY},o),t.e.preventDefault(),t.e.stopPropagation()})},Ne=e=>{e==null||e.off("mouse:up"),e==null||e.off("mouse:move"),e==null||e.off("mouse:down")},Y=25,Je=.5,Ke="fill:#64748b;stroke:#64748b;stroke-width:0.5;",Qe=[[Y,0],[0,0],[Y,Y],[0,Y]],et=({size:e=Y,radius:t=Je,circleStyle:n=Ke,circlePositions:o=Qe})=>`<svg width="${e/2}" height="${e/2}" viewBox="0 0 ${e/2} ${e/2}" version="1.1" xmlns="http://www.w3.org/2000/svg"><defs/><g>
    ${o.map(([l,r])=>`<circle style="${n}" cx="${l}" cy="${r}" r="${t}"/>`).join(`
`)}
    </g></svg>`,tt=({svgString:e})=>`data:image/svg+xml;utf8,${encodeURIComponent(e)}`,nt=()=>new w.fabric.Pattern({source:tt({svgString:et({})}),repeat:"repeat"}),ot=ie({__name:"FabricCanvas",props:{id:{}},emits:["mouse:dblclick","canvas-created"],setup(e,{emit:t}){we(),Ce();const n=W(null),o=W(null),l=W({width:0,height:0}),r=W(null);return je(()=>{var i,c,y,C;const s=new w.fabric.Canvas(r.value,{width:((i=o.value)==null?void 0:i.offsetWidth)||500,height:((c=o.value)==null?void 0:c.offsetHeight)||500});s&&(n.value=s,t("canvas-created",s),s.on("mouse:dblclick",()=>{t("mouse:dblclick")}),l.value={width:((y=o.value)==null?void 0:y.offsetWidth)||500,height:((C=o.value)==null?void 0:C.offsetHeight)||500},qe({canvas:s}),window.addEventListener("resize",()=>{Ze({canvas:s,containerRef:o.value})}))}),(s,i)=>(se(),le("div",{class:"container",ref_key:"containerRef",ref:o},[De("canvas",{id:"canvas",ref_key:"canvasReference",ref:r,width:500,height:500},null,512)],512))}});const rt=ke(ot,[["__scopeId","data-v-e56d0c65"]]),it=({canvas:e,action:t})=>{e==null||e.off("mouse:up"),e==null||e.off("mouse:move"),e==null||e.off("mouse:down"),e==null||e.on("mouse:up",n=>{const l=e.getActiveObjects().map(r=>(r==null?void 0:r.id)||"no id");if(l.length>0){console.log("ids",l),t("ObjContextMenu",l);return}t("mainMenu",[])})},be=e=>e==="drawing"||e==="panning",st=e=>{if(!e){console.error("makeAllObjCanvasSelectable: canvas is null");return}e.selection=!0,e==null||e.forEachObject(t=>{t.setOptions({evented:!0,selectable:!0,hasControls:!0,hasRotatingPoint:!0})})},lt=ie({__name:"MainDesign",setup(e){const t=we(),n=Ce(),o=W(null),l=r=>{n.setSelectedCanvas({selectedCanvas:r});const s=r.getCenter();new w.fabric.Circle({radius:20,fill:"#4f46e5",top:s.top+100,left:s.left+100}),new w.fabric.Triangle({width:60,height:70,fill:"#c026d3",top:s.top+50,left:s.left+50}),new w.fabric.IText("Test text",{fontSize:22,top:s.top,left:s.left,hasControls:!0,fontStyle:"normal",fontWeight:"normal",fontFamily:"Helvetica"}),new w.fabric.Line([80,10,200,150],{stroke:"#374151"}),new w.fabric.Polyline([{x:80,y:10},{x:200,y:150},{x:500,y:250}],{stroke:"#ea580c",fill:"transparent",strokeWidth:5,strokeLineCap:"round",strokeLineJoin:"round"}),console.log("handleCreated --->",r)};return $e(()=>({getCanvasMode:t.getCanvasMode,getDrawingMode:n.getDrawingMode,getIsDotBackground:t.getIsDotBackground,getSelectedCanvas:n.getSelectedCanvas}),r=>{const{getCanvasMode:s,getDrawingMode:i,getSelectedCanvas:c,getIsDotBackground:y}=r;switch(be(s)&&ye(c),be(s)||st(c),t.getCanvasMode){case"drawing":Ve({canvas:c,drawingMode:i});break;case"panning":He({canvas:c});break;case"mainMenu":case"ObjContextMenu":it({canvas:c,action:(C,k)=>{t.setCanvasMode({canvasMode:C}),n.setSelectedObjectIds({selectedObjectIds:k})}});break;default:Ne(c);break}Ge({canvas:c,backgroundColor:y?nt():"transparent"})}),(r,s)=>(se(),le("div",{class:"design-canvas-container",ref_key:"elRef",ref:o},[Se(rt,{onCanvasCreated:l,id:"1"})],512))}});const ut=ke(lt,[["__scopeId","data-v-23e0d149"]]),ft=ie({__name:"DesignView",setup(e){return(t,n)=>(se(),le("main",null,[Se(ut)]))}});export{ft as default};
