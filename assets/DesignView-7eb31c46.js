import{f as y,d as ie,u as be,b as we,r as R,e as ve,o as se,c as le,a as Me,_ as ye,w as je,g as Ce}from"./index-a3444e00.js";const ke=e=>{if(!e){console.error("makeAllObjCanvasUnselectable: canvas is null");return}e.selection=!1,e.discardActiveObject(),e.forEachObject(t=>{t.setOptions({evented:!1,selectable:!1,hasControls:!1,hasRotatingPoint:!1})})},De=e=>{if(!e.length)return"";const t=e.reduce((n,[r,i],l,s)=>{const[o,f]=s[(l+1)%s.length];return n.push(r,i,(r+o)/2,(i+f)/2),n},["M",...e[0],"Q"]);return t.push("Z"),t.join(" ")};function he(e,t,n,r=i=>i){return e*r(.5-t*(.5-n))}function $e(e){return[-e[0],-e[1]]}function w(e,t){return[e[0]+t[0],e[1]+t[1]]}function _(e,t){return[e[0]-t[0],e[1]-t[1]]}function b(e,t){return[e[0]*t,e[1]*t]}function Ae(e,t){return[e[0]/t,e[1]/t]}function L(e){return[e[1],-e[0]]}function de(e,t){return e[0]*t[0]+e[1]*t[1]}function Re(e,t){return e[0]===t[0]&&e[1]===t[1]}function Be(e){return Math.hypot(e[0],e[1])}function ze(e){return e[0]*e[0]+e[1]*e[1]}function pe(e,t){return ze(_(e,t))}function xe(e){return Ae(e,Be(e))}function Fe(e,t){return Math.hypot(e[1]-t[1],e[0]-t[0])}function T(e,t,n){let r=Math.sin(n),i=Math.cos(n),l=e[0]-t[0],s=e[1]-t[1],o=l*i-s*r,f=l*r+s*i;return[o+t[0],f+t[1]]}function re(e,t,n){return w(e,b(_(t,e),n))}function ge(e,t,n){return w(e,b(t,n))}var{min:$,PI:Ie}=Math,me=.275,W=Ie+1e-4;function Le(e,t={}){let{size:n=16,smoothing:r=.5,thinning:i=.5,simulatePressure:l=!0,easing:s=u=>u,start:o={},end:f={},last:m=!1}=t,{cap:C=!0,easing:k=u=>u*(2-u)}=o,{cap:j=!0,easing:p=u=>--u*u*u+1}=f;if(e.length===0||n<=0)return[];let d=e[e.length-1].runningLength,x=o.taper===!1?0:o.taper===!0?Math.max(n,d):o.taper,B=f.taper===!1?0:f.taper===!0?Math.max(n,d):f.taper,ue=Math.pow(n*r,2),z=[],D=[],Z=e.slice(0,10).reduce((u,h)=>{let c=h.pressure;if(l){let a=$(1,h.distance/n),Q=$(1,1-a);c=$(1,u+(Q-u)*(a*me))}return(u+c)/2},e[0].pressure),g=he(n,i,e[e.length-1].pressure,s),q,N=e[0].vector,F=e[0].point,X=F,v=F,M=X,J=!1;for(let u=0;u<e.length;u++){let{pressure:h}=e[u],{point:c,vector:a,distance:Q,runningLength:I}=e[u];if(u<e.length-1&&d-I<3)continue;if(i){if(l){let P=$(1,Q/n),te=$(1,1-P);h=$(1,Z+(te-Z)*(P*me))}g=he(n,i,h,s)}else g=n/2;q===void 0&&(q=g);let Se=I<x?k(I/x):1,Oe=d-I<B?p((d-I)/B):1;g=Math.max(.01,g*Math.min(Se,Oe));let ce=(u<e.length-1?e[u+1]:e[u]).vector,ee=u<e.length-1?de(a,ce):1,Pe=de(a,N)<0&&!J,fe=ee!==null&&ee<0;if(Pe||fe){let P=b(L(N),g);for(let te=1/13,E=0;E<=1;E+=te)v=T(_(c,P),c,W*E),z.push(v),M=T(w(c,P),c,W*-E),D.push(M);F=v,X=M,fe&&(J=!0);continue}if(J=!1,u===e.length-1){let P=b(L(a),g);z.push(_(c,P)),D.push(w(c,P));continue}let ae=b(L(re(ce,a,ee)),g);v=_(c,ae),(u<=1||pe(F,v)>ue)&&(z.push(v),F=v),M=w(c,ae),(u<=1||pe(X,M)>ue)&&(D.push(M),X=M),Z=h,N=a}let S=e[0].point.slice(0,2),O=e.length>1?e[e.length-1].point.slice(0,2):w(e[0].point,[1,1]),K=[],V=[];if(e.length===1){if(!(x||B)||m){let u=ge(S,xe(L(_(S,O))),-(q||g)),h=[];for(let c=1/13,a=c;a<=1;a+=c)h.push(T(u,S,W*2*a));return h}}else{if(!(x||B&&e.length===1))if(C)for(let h=1/13,c=h;c<=1;c+=h){let a=T(D[0],S,W*c);K.push(a)}else{let h=_(z[0],D[0]),c=b(h,.5),a=b(h,.51);K.push(_(S,c),_(S,a),w(S,a),w(S,c))}let u=L($e(e[e.length-1].vector));if(B||x&&e.length===1)V.push(O);else if(j){let h=ge(O,u,g);for(let c=1/29,a=c;a<1;a+=c)V.push(T(h,O,W*3*a))}else V.push(w(O,b(u,g)),w(O,b(u,g*.99)),_(O,b(u,g*.99)),_(O,b(u,g)))}return z.concat(V,D.reverse(),K)}function Te(e,t={}){var n;let{streamline:r=.5,size:i=16,last:l=!1}=t;if(e.length===0)return[];let s=.15+(1-r)*.85,o=Array.isArray(e[0])?e:e.map(({x:p,y:d,pressure:x=.5})=>[p,d,x]);if(o.length===2){let p=o[1];o=o.slice(0,-1);for(let d=1;d<5;d++)o.push(re(o[0],p,d/4))}o.length===1&&(o=[...o,[...w(o[0],[1,1]),...o[0].slice(2)]]);let f=[{point:[o[0][0],o[0][1]],pressure:o[0][2]>=0?o[0][2]:.25,vector:[1,1],distance:0,runningLength:0}],m=!1,C=0,k=f[0],j=o.length-1;for(let p=1;p<o.length;p++){let d=l&&p===j?o[p].slice(0,2):re(k.point,o[p],s);if(Re(k.point,d))continue;let x=Fe(d,k.point);if(C+=x,p<j&&!m){if(C<i)continue;m=!0}k={point:d,pressure:o[p][2]>=0?o[p][2]:.5,vector:xe(_(k.point,d)),distance:x,runningLength:C},f.push(k)}return f[0].vector=((n=f[1])==null?void 0:n.vector)||[0,0],f}function We(e,t={}){return Le(Te(e,t),t)}var Ye=We;const _e="drawnObjects";let G=!1,ne=[[0,0]],A=null;const Xe=({canvas:e,drawingMode:t})=>{if(!e){console.error("drawStrokeOnCanvas: canvas is null");return}e==null||e.off("mouse:up"),e==null||e.off("mouse:move"),e==null||e.off("mouse:down"),e.on("mouse:down",n=>{G=!0,A=null;const r=e.getPointer(n.e);ne=[[r.x,r.y]]}),e.on("mouse:move",n=>{if(!G)return;e.discardActiveObject();const r=e.getPointer(n.e);ne.push([r.x,r.y]);const i=Ye(ne,{size:t.size,thinning:t.thinning,smoothing:t.smoothing,streamline:t.streamline,easing(s){return s=Math.max(0,Math.min(1,s)),s*s*(3-2*s)}}),l=De(i);y.fabric.loadSVGFromString(`<svg>
         <path fill="${t.stroke}" d="${l}" />
      </svg>`,s=>{const o=new y.fabric.Group(s,{id:_e,selectable:!1,hasRotatingPoint:!1});A=o,e.add(o)})}),e.on("mouse:up",n=>{if(!G)return;const i=e.getObjects().filter(l=>(l==null?void 0:l.id)===_e);if(i.length>0&&A){for(let l=0;l<i.length;l++)e.remove(i[l]);A.setOptions({id:"",selectable:!0,hasRotatingPoint:!0}),A.bringForward(!0),e.add(A),e.renderAll()}ke(e),G=!1})},Ve=(e,t)=>{if(e)return setTimeout(()=>e.requestRenderAll(),t)},Ee=({canvas:e,backgroundColor:t})=>{e&&e.setBackgroundColor(t,()=>Ve(e,0))};let H=0,U=0,oe=!1;const Ge=({canvas:e})=>{e&&(e==null||e.off("mouse:up"),e==null||e.off("mouse:move"),e==null||e.off("mouse:down"),e.on("mouse:down",t=>{var n,r,i;if(oe=!0,t&&t.e&&t.e.type==="touchstart"){const l=t.e;H=(n=l==null?void 0:l.changedTouches[0])==null?void 0:n.clientX,U=(r=l==null?void 0:l.changedTouches[0])==null?void 0:r.clientY}(i=t.target)==null||i.setOptions({opacity:.5})}),e.on("mouse:move",t=>{if(!(!oe||!t||!t.e||t.target)){if(t.e.type==="mousemove"){const n=new y.fabric.Point(t.e.movementX,t.e.movementY);e.relativePan(n)}if(t.e.type==="touchmove"){const n=t.e,r=n==null?void 0:n.touches[0];if(!r)return;const i=.9;let l=(r.clientX-H)*i,s=(r.clientY-U)*i;H=r.clientX,U=r.clientY;const o=new y.fabric.Point(l,s);e.relativePan(o)}}}),e.on("mouse:up",t=>{var n;oe=!1,(n=t.target)==null||n.setOptions({opacity:1}),H=0,U=0}))},He=({canvas:e,containerRef:t})=>{const n=(t==null?void 0:t.offsetWidth)||500,r=(t==null?void 0:t.offsetHeight)||500;e==null||e.setDimensions({width:n,height:r})},Ue=({canvas:e})=>{e.on("mouse:wheel",t=>{const n=t.e.deltaY;let r=e.getZoom();r*=.999**n,r>20&&(r=20),r<.01&&(r=.01),e.zoomToPoint({x:t.e.offsetX,y:t.e.offsetY},r),t.e.preventDefault(),t.e.stopPropagation()})},Ze=e=>{e==null||e.off("mouse:up"),e==null||e.off("mouse:move"),e==null||e.off("mouse:down")},Y=25,qe=.5,Ne="fill:#64748b;stroke:#64748b;stroke-width:0.5;",Je=[[Y,0],[0,0],[Y,Y],[0,Y]],Ke=({size:e=Y,radius:t=qe,circleStyle:n=Ne,circlePositions:r=Je})=>`<svg width="${e/2}" height="${e/2}" viewBox="0 0 ${e/2} ${e/2}" version="1.1" xmlns="http://www.w3.org/2000/svg"><defs/><g>
    ${r.map(([i,l])=>`<circle style="${n}" cx="${i}" cy="${l}" r="${t}"/>`).join(`
`)}
    </g></svg>`,Qe=({svgString:e})=>`data:image/svg+xml;utf8,${encodeURIComponent(e)}`,et=()=>new y.fabric.Pattern({source:Qe({svgString:Ke({})}),repeat:"repeat"}),tt=ie({__name:"FabricCanvas",props:{id:{}},emits:["mouse:dblclick","canvas-created"],setup(e,{emit:t}){be(),we();const n=R(null),r=R(null),i=R({width:0,height:0}),l=R(null);return ve(()=>{var o,f,m,C;const s=new y.fabric.Canvas(l.value,{width:((o=r.value)==null?void 0:o.offsetWidth)||500,height:((f=r.value)==null?void 0:f.offsetHeight)||500});s&&(n.value=s,t("canvas-created",s),s.on("mouse:dblclick",()=>{t("mouse:dblclick")}),i.value={width:((m=r.value)==null?void 0:m.offsetWidth)||500,height:((C=r.value)==null?void 0:C.offsetHeight)||500},Ue({canvas:s}),window.addEventListener("resize",()=>{He({canvas:s,containerRef:r.value})}))}),(s,o)=>(se(),le("div",{class:"container",ref_key:"containerRef",ref:r},[Me("canvas",{id:"canvas",ref_key:"canvasReference",ref:l,width:500,height:500},null,512)],512))}});const nt=ye(tt,[["__scopeId","data-v-e56d0c65"]]),ot=e=>{if(!e){console.error("makeAllObjCanvasSelectable: canvas is null");return}e.selection=!0,e==null||e.forEachObject(t=>{t.setOptions({evented:!0,selectable:!0,hasControls:!0,hasRotatingPoint:!0})})},rt=ie({__name:"MainDesign",setup(e){const t=be(),n=we(),r=R(null),i=R(null),l=s=>{i.value=s;const o=s.getCenter(),f=new y.fabric.Circle({radius:20,fill:"#4f46e5",top:o.top+100,left:o.left+100}),m=new y.fabric.Triangle({width:60,height:70,fill:"#c026d3",top:o.top+50,left:o.left+50}),C=new y.fabric.IText("Test text",{fontSize:22,top:o.top,left:o.left,hasControls:!0,fontStyle:"normal",fontWeight:"normal",fontFamily:"Helvetica"}),k=new y.fabric.Line([80,10,200,150],{stroke:"#374151"}),j=new y.fabric.Polyline([{x:80,y:10},{x:200,y:150},{x:500,y:250}],{stroke:"#ea580c",fill:"transparent",strokeWidth:5,strokeLineCap:"round",strokeLineJoin:"round"});s.add(f,m,k,j,C),console.log("handleCreated --->",s)};return je([t,n],s=>{const{getDrawingMode:o}=s[1],{getIsDotBackground:f,getCanvasMode:m}=s[0];switch(m==="drawing"&&ke(i.value),m!=="drawing"&&ot(i.value),m){case"drawing":Xe({canvas:i.value,drawingMode:o});break;case"panning":Ge({canvas:i.value});break;default:Ze(i.value);break}Ee({canvas:i.value,backgroundColor:f?et():"transparent"})}),(s,o)=>(se(),le("div",{class:"design-canvas-container",ref_key:"elRef",ref:r},[Ce(nt,{onCanvasCreated:l,id:"1"})],512))}});const it=ye(rt,[["__scopeId","data-v-6c5fef2e"]]),lt=ie({__name:"DesignView",setup(e){return(t,n)=>(se(),le("main",null,[Ce(it)]))}});export{lt as default};
