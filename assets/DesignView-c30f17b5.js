import{d as ce,u as Se,b as Pe,r as T,e as De,f as _,o as de,c as ae,a as ze,_ as Ae,g as Ee,h as Fe,i as Ye,w as Xe,j as Ie,k as He}from"./index-f389e508.js";const Ue=({canvas:e,containerRef:t})=>{const o=(t==null?void 0:t.offsetWidth)||500,n=(t==null?void 0:t.offsetHeight)||500;e==null||e.setDimensions({width:o,height:n})},$e=({canvas:e})=>{e.on("mouse:wheel",t=>{const o=t.e.deltaY;let n=e.getZoom();n*=.999**o,n>20&&(n=20),n<.01&&(n=.01),e.zoomToPoint({x:t.e.offsetX,y:t.e.offsetY},n),t.e.preventDefault(),t.e.stopPropagation()})},qe=ce({__name:"FabricCanvas",props:{id:{}},emits:["mouse:dblclick","canvas-created"],setup(e,{emit:t}){Se(),Pe();const o=T(null),n=T(null),i=T({width:0,height:0}),s=T(null);return De(()=>{var r,u,g,k;const l=new _.fabric.Canvas(s.value,{width:((r=n.value)==null?void 0:r.offsetWidth)||500,height:((u=n.value)==null?void 0:u.offsetHeight)||500});l&&(o.value=l,t("canvas-created",l),l.on("mouse:dblclick",()=>{t("mouse:dblclick")}),i.value={width:((g=n.value)==null?void 0:g.offsetWidth)||500,height:((k=n.value)==null?void 0:k.offsetHeight)||500},$e({canvas:l}),window.addEventListener("resize",()=>{Ue({canvas:l,containerRef:n.value})}))}),(l,r)=>(de(),ae("div",{class:"container",ref_key:"containerRef",ref:n},[ze("canvas",{id:"canvas",ref_key:"canvasReference",ref:s,width:500,height:500},null,512)],512))}});const Ve=Ae(qe,[["__scopeId","data-v-3428e730"]]),Ze=e=>{const t=T(null),o=()=>{t.value&&window.addEventListener("keydown",t.value)},n=()=>{t.value&&window.removeEventListener("keydown",t.value)};return De(()=>{t.value=e}),Ee(()=>{n()}),{addListener:o,removeListener:n}},ve=(e,t)=>{if(e.key==="Backspace"){const o=t.getActiveObject();if(!o)return;t.remove(o)}},Le=e=>{if(!e){console.error("makeAllObjCanvasUnselectable: canvas is null");return}e.selection=!1,e.discardActiveObject(),e.forEachObject(t=>{t.setOptions({evented:!1,selectable:!1,hasControls:!1,hasRotatingPoint:!1})})},Ge=e=>{if(!e.length)return"";const t=e.reduce((o,[n,i],s,l)=>{const[r,u]=l[(s+1)%l.length];return o.push(n,i,(n+r)/2,(i+u)/2),o},["M",...e[0],"Q"]);return t.push("Z"),t.join(" ")},he=()=>`id-${Math.random().toString(16).slice(2)}`;function _e(e,t,o,n=i=>i){return e*n(.5-t*(.5-o))}function Ke(e){return[-e[0],-e[1]]}function C(e,t){return[e[0]+t[0],e[1]+t[1]]}function b(e,t){return[e[0]-t[0],e[1]-t[1]]}function w(e,t){return[e[0]*t,e[1]*t]}function Ne(e,t){return[e[0]/t,e[1]/t]}function E(e){return[e[1],-e[0]]}function we(e,t){return e[0]*t[0]+e[1]*t[1]}function Je(e,t){return e[0]===t[0]&&e[1]===t[1]}function Qe(e){return Math.hypot(e[0],e[1])}function et(e){return e[0]*e[0]+e[1]*e[1]}function Ce(e,t){return et(b(e,t))}function Te(e){return Ne(e,Qe(e))}function tt(e,t){return Math.hypot(e[1]-t[1],e[0]-t[0])}function F(e,t,o){let n=Math.sin(o),i=Math.cos(o),s=e[0]-t[0],l=e[1]-t[1],r=s*i-l*n,u=s*n+l*i;return[r+t[0],u+t[1]]}function fe(e,t,o){return C(e,w(b(t,e),o))}function ke(e,t,o){return C(e,w(t,o))}var{min:I,PI:ot}=Math,ye=.275,Y=ot+1e-4;function nt(e,t={}){let{size:o=16,smoothing:n=.5,thinning:i=.5,simulatePressure:s=!0,easing:l=f=>f,start:r={},end:u={},last:g=!1}=t,{cap:k=!0,easing:y=f=>f*(2-f)}=r,{cap:D=!0,easing:a=f=>--f*f*f+1}=u;if(e.length===0||o<=0)return[];let h=e[e.length-1].runningLength,O=r.taper===!1?0:r.taper===!0?Math.max(o,h):r.taper,R=u.taper===!1?0:u.taper===!0?Math.max(o,h):u.taper,ge=Math.pow(o*n,2),B=[],A=[],N=e.slice(0,10).reduce((f,p)=>{let c=p.pressure;if(s){let d=I(1,p.distance/o),oe=I(1,1-d);c=I(1,f+(oe-f)*(d*ye))}return(f+c)/2},e[0].pressure),m=_e(o,i,e[e.length-1].pressure,l),J,Q=e[0].vector,W=e[0].point,$=W,S=W,P=$,ee=!1;for(let f=0;f<e.length;f++){let{pressure:p}=e[f],{point:c,vector:d,distance:oe,runningLength:z}=e[f];if(f<e.length-1&&h-z<3)continue;if(i){if(s){let j=I(1,oe/o),re=I(1,1-j);p=I(1,N+(re-N)*(j*ye))}m=_e(o,i,p,l)}else m=o/2;J===void 0&&(J=m);let Re=z<O?y(z/O):1,Be=h-z<R?a((h-z)/R):1;m=Math.max(.01,m*Math.min(Re,Be));let pe=(f<e.length-1?e[f+1]:e[f]).vector,ne=f<e.length-1?we(d,pe):1,We=we(d,Q)<0&&!ee,me=ne!==null&&ne<0;if(We||me){let j=w(E(Q),m);for(let re=1/13,V=0;V<=1;V+=re)S=F(b(c,j),c,Y*V),B.push(S),P=F(C(c,j),c,Y*-V),A.push(P);W=S,$=P,me&&(ee=!0);continue}if(ee=!1,f===e.length-1){let j=w(E(d),m);B.push(b(c,j)),A.push(C(c,j));continue}let be=w(E(fe(pe,d,ne)),m);S=b(c,be),(f<=1||Ce(W,S)>ge)&&(B.push(S),W=S),P=C(c,be),(f<=1||Ce($,P)>ge)&&(A.push(P),$=P),N=p,Q=d}let M=e[0].point.slice(0,2),x=e.length>1?e[e.length-1].point.slice(0,2):C(e[0].point,[1,1]),te=[],q=[];if(e.length===1){if(!(O||R)||g){let f=ke(M,Te(E(b(M,x))),-(J||m)),p=[];for(let c=1/13,d=c;d<=1;d+=c)p.push(F(f,M,Y*2*d));return p}}else{if(!(O||R&&e.length===1))if(k)for(let p=1/13,c=p;c<=1;c+=p){let d=F(A[0],M,Y*c);te.push(d)}else{let p=b(B[0],A[0]),c=w(p,.5),d=w(p,.51);te.push(b(M,c),b(M,d),C(M,d),C(M,c))}let f=E(Ke(e[e.length-1].vector));if(R||O&&e.length===1)q.push(x);else if(D){let p=ke(x,f,m);for(let c=1/29,d=c;d<1;d+=c)q.push(F(p,x,Y*3*d))}else q.push(C(x,w(f,m)),C(x,w(f,m*.99)),b(x,w(f,m*.99)),b(x,w(f,m)))}return B.concat(q,A.reverse(),te)}function rt(e,t={}){var o;let{streamline:n=.5,size:i=16,last:s=!1}=t;if(e.length===0)return[];let l=.15+(1-n)*.85,r=Array.isArray(e[0])?e:e.map(({x:a,y:h,pressure:O=.5})=>[a,h,O]);if(r.length===2){let a=r[1];r=r.slice(0,-1);for(let h=1;h<5;h++)r.push(fe(r[0],a,h/4))}r.length===1&&(r=[...r,[...C(r[0],[1,1]),...r[0].slice(2)]]);let u=[{point:[r[0][0],r[0][1]],pressure:r[0][2]>=0?r[0][2]:.25,vector:[1,1],distance:0,runningLength:0}],g=!1,k=0,y=u[0],D=r.length-1;for(let a=1;a<r.length;a++){let h=s&&a===D?r[a].slice(0,2):fe(y.point,r[a],l);if(Je(y.point,h))continue;let O=tt(h,y.point);if(k+=O,a<D&&!g){if(k<i)continue;g=!0}y={point:h,pressure:r[a][2]>=0?r[a][2]:.5,vector:Te(b(y.point,h)),distance:O,runningLength:k},u.push(y)}return u[0].vector=((o=u[1])==null?void 0:o.vector)||[0,0],u}function it(e,t={}){return nt(rt(e,t),t)}var st=it;const Oe="drawnObjects";let Z=!1,ie=[[0,0]],L=null;const lt=({canvas:e,drawingSettings:t})=>{if(!e){console.error("drawStrokeOnCanvas: canvas is null");return}e==null||e.off("mouse:up"),e==null||e.off("mouse:move"),e==null||e.off("mouse:down"),e.on("mouse:down",o=>{Z=!0,L=null;const n=e.getPointer(o.e);ie=[[n.x,n.y]]}),e.on("mouse:move",o=>{if(!Z)return;e.discardActiveObject();const n=e.getPointer(o.e);ie.push([n.x,n.y]);const i=st(ie,{size:t.size,thinning:t.thinning,smoothing:t.smoothing,streamline:t.streamline,easing(l){return l=Math.max(0,Math.min(1,l)),l*l*(3-2*l)}}),s=Ge(i);_.fabric.loadSVGFromString(`<svg>
         <path fill="${t.stroke}" d="${s}" />
      </svg>`,l=>{const r=new _.fabric.Group(l,{id:Oe,selectable:!1,hasRotatingPoint:!1});L=r,e.add(r)})}),e.on("mouse:up",o=>{if(!Z)return;const i=e.getObjects().filter(s=>(s==null?void 0:s.id)===Oe);if(i.length>0&&L){for(let s=0;s<i.length;s++)e.remove(i[s]);L.setOptions({selectable:!0,id:he(),hasRotatingPoint:!0}),L.bringForward(!0),e.add(L),e.renderAll()}Le(e),Z=!1})},ut=(e,t)=>{if(e)return setTimeout(()=>e.requestRenderAll(),t)},ft=({canvas:e,backgroundColor:t})=>{e&&e.setBackgroundColor(t,()=>ut(e,0))};let v=0,G=0,se=!1;const ct=({canvas:e})=>{e&&(e==null||e.off("mouse:up"),e==null||e.off("mouse:move"),e==null||e.off("mouse:down"),e.on("mouse:down",t=>{var o,n,i;if(se=!0,t&&t.e&&t.e.type==="touchstart"){const s=t.e;v=(o=s==null?void 0:s.changedTouches[0])==null?void 0:o.clientX,G=(n=s==null?void 0:s.changedTouches[0])==null?void 0:n.clientY}(i=t.target)==null||i.setOptions({opacity:.5})}),e.on("mouse:move",t=>{if(!(!se||!t||!t.e||t.target)){if(t.e.type==="mousemove"){const o=new _.fabric.Point(t.e.movementX,t.e.movementY);e.relativePan(o)}if(t.e.type==="touchmove"){const o=t.e,n=o==null?void 0:o.touches[0];if(!n)return;const i=.9;let s=(n.clientX-v)*i,l=(n.clientY-G)*i;v=n.clientX,G=n.clientY;const r=new _.fabric.Point(s,l);e.relativePan(r)}}}),e.on("mouse:up",t=>{var o;se=!1,(o=t.target)==null||o.setOptions({opacity:1}),v=0,G=0}))};let le=0;const Me=200;let K=!1;const xe=({canvas:e,action:t,removeListener:o})=>{e==null||e.off("mouse:up"),e==null||e.off("mouse:move"),e==null||e.off("mouse:down"),e==null||e.on("mouse:up",n=>{le&&clearTimeout(le),le=setTimeout(()=>{if(K)return;const s=e.getActiveObjects().map(l=>(l==null?void 0:l.id)||"no id");if(s.length>0){t("ObjContextMenu",s);return}t("mainMenu",[])},Me)}),e==null||e.on("mouse:dblclick",n=>{var s,l;const i=e.findTarget(n.e,!0);if(console.log("double clicked type ---->",i==null?void 0:i.type),!K){if((i==null?void 0:i.type)==="i-text"){o();const r=i;if(r!=null&&r.isEditing)return;r.enterEditing()}if((i==null?void 0:i.type)==="rect"||!i){const r={x:((s=n.pointer)==null?void 0:s.x)||0,y:((l=n.pointer)==null?void 0:l.y)||0},u=new _.fabric.IText("Double click to edit text",{fontSize:16,editable:!0,selected:!0,fontWeight:"bold",top:r.y,left:r.x,hasRotatingPoint:!0,fontFamily:"Montserrat"});u.id=he(),e.discardActiveObject(),u.bringToFront(),e==null||e.add(u)}K=!0,setTimeout(()=>{K=!1},Me+100)}})},dt=Fe();let X="",H=0,U=0,ue=!1;const at=({canvas:e,endAction:t,squareModeSettings:o})=>{e&&(e==null||e.off("mouse:up"),e==null||e.off("mouse:move"),e==null||e.off("mouse:down"),e.on("mouse:down",n=>{ue=!0;const i=e.getPointer(n.e);H=i.x,U=i.y;const s=new _.fabric.Rect({angle:0,top:U,left:H,evented:!0,originY:"top",originX:"left",selectable:!0,hasRotatingPoint:!0,width:i.x-H,height:i.y-U,rx:o.rx,ry:o.ry,stroke:o.stroke,strokeWidth:o.strokeWidth,fill:Ye({pasterns:dt,stroke:o.stroke,background:o.background})});s.id=he(),X=s.id,e.add(s)}),e.on("mouse:move",n=>{if(!ue||!X)return;const i=e.getPointer(n.e),l=e.getObjects().find(r=>r.id===X);l&&(H>i.x&&l.set({left:Math.abs(i.x)}),U>i.y&&l.set({top:Math.abs(i.y)}),l.setOptions({width:Math.abs(H-i.x),height:Math.abs(U-i.y)}),e.renderAll())}),e.on("mouse:up",n=>{ue=!1,t(X),X=""}))},je=e=>e==="drawing"||e==="panning",ht=e=>{if(!e){console.error("makeAllObjCanvasSelectable: canvas is null");return}e.selection=!0,e.forEachObject(t=>{t.setOptions({evented:!0,selectable:!0,hasControls:!0,hasRotatingPoint:!0})})},gt=e=>{e==null||e.off("mouse:up"),e==null||e.off("mouse:move"),e==null||e.off("mouse:down")},pt=ce({__name:"MainCanvas",setup(e){const t=Se(),o=Pe(),n=T(null),i=r=>{o.setSelectedCanvas({selectedCanvas:r});const u=r.getCenter();new _.fabric.Circle({radius:20,fill:"#4f46e5",top:u.top+100,left:u.left+100}),new _.fabric.Triangle({width:60,height:70,fill:"#c026d3",top:u.top+50,left:u.left+50}),new _.fabric.IText("Test text",{fontSize:22,top:u.top,left:u.left,hasControls:!0,fontStyle:"normal",fontWeight:"normal",fontFamily:"Helvetica"}),new _.fabric.Line([80,10,200,150],{stroke:"#374151"}),new _.fabric.Polyline([{x:80,y:10},{x:200,y:150},{x:500,y:250}],{stroke:"#ea580c",fill:"transparent",strokeWidth:5,strokeLineCap:"round",strokeLineJoin:"round"})},{addListener:s,removeListener:l}=Ze(r=>{const u=o.getSelectedCanvas;u&&ve(r,u)});return Xe(()=>({getCanvasMode:t.getCanvasMode,getIsDotBackground:t.getIsDotBackground,getSelectedCanvas:o.getSelectedCanvas,getDrawingSettings:o.getDrawingSettings,getSquareModeSettings:o.getSquareModeSettings}),r=>{const{getCanvasMode:u,getSelectedCanvas:g,getDrawingSettings:k,getIsDotBackground:y,getSquareModeSettings:D}=r;switch(je(u)&&Le(g),je(u)||ht(g),t.getCanvasMode){case"drawing":lt({canvas:g,drawingSettings:k});break;case"panning":ct({canvas:g});break;case"square":at({canvas:g,squareModeSettings:D,endAction:a=>{t.setCanvasMode({canvasMode:"ObjContextMenu"}),o.setSelectedObjectIds({selectedObjectIds:[a]})}});break;case"mainMenu":xe({removeListener:l,canvas:g,action:(a,h)=>{t.setCanvasMode({canvasMode:a}),o.setSelectedObjectIds({selectedObjectIds:h})}});break;case"ObjContextMenu":s(),xe({removeListener:l,canvas:g,action:(a,h)=>{t.setCanvasMode({canvasMode:a}),o.setSelectedObjectIds({selectedObjectIds:h})}});break;default:gt(g);break}ft({canvas:g,backgroundColor:y?He({}):"transparent"})}),(r,u)=>(de(),ae("div",{class:"design-canvas-container",ref_key:"elRef",ref:n},[Ie(Ve,{onCanvasCreated:i,id:"1"})],512))}});const mt=Ae(pt,[["__scopeId","data-v-65ae84dc"]]),_t=ce({__name:"DesignView",setup(e){return(t,o)=>(de(),ae("main",null,[Ie(mt)]))}});export{_t as default};
