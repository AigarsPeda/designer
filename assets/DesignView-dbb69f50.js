import{d as le,r as B,b as Oe,f as L,o as ce,c as ue,a as Be,_ as Me,e as Le,g as Re,h as Ye,u as ze,i as Ie,w as We,j as ye,k as Xe}from"./index-23bb03e5.js";const Ee=({canvas:e,containerRef:t})=>{const n=(t==null?void 0:t.offsetWidth)||500,o=(t==null?void 0:t.offsetHeight)||500;e==null||e.setDimensions({width:n,height:o})},Fe=({canvas:e})=>{e.on("mouse:wheel",t=>{const n=t.e.deltaY;let o=e.getZoom();o*=.999**n,o>20&&(o=20),o<.01&&(o=.01),e.zoomToPoint({x:t.e.offsetX,y:t.e.offsetY},o),t.e.preventDefault(),t.e.stopPropagation()})},Ue=le({__name:"FabricCanvas",props:{id:{}},emits:["canvas-created","selection-created","selection-cleared","selection-updated"],setup(e,{emit:t}){const n=B(null),o=B(null),i=B({width:0,height:0}),s=B(null);return Oe(()=>{var r,f,h,m;const a=new L.fabric.Canvas(s.value,{width:((r=o.value)==null?void 0:r.offsetWidth)||500,height:((f=o.value)==null?void 0:f.offsetHeight)||500});a&&(n.value=a,t("canvas-created",a),a.on("selection:created",u=>{t("selection-created",u)}),a.on("selection:updated",u=>{t("selection-updated",u)}),a.on("selection:cleared",u=>{t("selection-cleared",u)}),i.value={width:((h=o.value)==null?void 0:h.offsetWidth)||500,height:((m=o.value)==null?void 0:m.offsetHeight)||500},Fe({canvas:a}),window.addEventListener("resize",()=>{Ee({canvas:a,containerRef:o.value})}))}),(a,r)=>(ce(),ue("div",{class:"container",ref_key:"containerRef",ref:o},[Be("canvas",{id:"canvas",ref_key:"canvasReference",ref:s,width:500,height:500},null,512)],512))}});const qe=Me(Ue,[["__scopeId","data-v-3cced8b0"]]),He=e=>{const t=B(null),n=()=>{t.value&&window.addEventListener("keydown",t.value)},o=()=>{t.value&&window.removeEventListener("keydown",t.value)};return Oe(()=>{t.value=e}),Le(()=>{o()}),{addListener:n,removeListener:o}},Te=(e,t)=>{if(e.key==="Backspace"){const n=t.getActiveObject();if(!n)return;t.remove(n)}},je=e=>{if(!e){console.error("makeAllObjCanvasUnselectable: canvas is null");return}e.selection=!1,e.discardActiveObject(),e.forEachObject(t=>{t.setOptions({evented:!1,selectable:!1,hasControls:!1,hasRotatingPoint:!1})})},pe=e=>{e==null||e.off("mouse:up"),e==null||e.off("mouse:down"),e==null||e.off("mouse:move")},$e=e=>{if(!e.length)return"";const t=e.reduce((n,[o,i],s,a)=>{const[r,f]=a[(s+1)%a.length];return n.push(o,i,(o+r)/2,(i+f)/2),n},["M",...e[0],"Q"]);return t.push("Z"),t.join(" ")},Se=()=>`id-${Math.random().toString(16).slice(2)}`;function be(e,t,n,o=i=>i){return e*o(.5-t*(.5-n))}function Ve(e){return[-e[0],-e[1]]}function w(e,t){return[e[0]+t[0],e[1]+t[1]]}function _(e,t){return[e[0]-t[0],e[1]-t[1]]}function C(e,t){return[e[0]*t,e[1]*t]}function Ze(e,t){return[e[0]/t,e[1]/t]}function W(e){return[e[1],-e[0]]}function me(e,t){return e[0]*t[0]+e[1]*t[1]}function Ge(e,t){return e[0]===t[0]&&e[1]===t[1]}function Ke(e){return Math.hypot(e[0],e[1])}function Ne(e){return e[0]*e[0]+e[1]*e[1]}function ve(e,t){return Ne(_(e,t))}function xe(e){return Ze(e,Ke(e))}function Qe(e,t){return Math.hypot(e[1]-t[1],e[0]-t[0])}function X(e,t,n){let o=Math.sin(n),i=Math.cos(n),s=e[0]-t[0],a=e[1]-t[1],r=s*i-a*o,f=s*o+a*i;return[r+t[0],f+t[1]]}function ae(e,t,n){return w(e,C(_(t,e),n))}function _e(e,t,n){return w(e,C(t,n))}var{min:D,PI:Je}=Math,Ce=.275,E=Je+1e-4;function et(e,t={}){let{size:n=16,smoothing:o=.5,thinning:i=.5,simulatePressure:s=!0,easing:a=l=>l,start:r={},end:f={},last:h=!1}=t,{cap:m=!0,easing:u=l=>l*(2-l)}=r,{cap:x=!0,easing:b=l=>--l*l*l+1}=f;if(e.length===0||n<=0)return[];let g=e[e.length-1].runningLength,k=r.taper===!1?0:r.taper===!0?Math.max(n,g):r.taper,R=f.taper===!1?0:f.taper===!0?Math.max(n,g):f.taper,de=Math.pow(n*o,2),Y=[],P=[],K=e.slice(0,10).reduce((l,p)=>{let c=p.pressure;if(s){let d=D(1,p.distance/n),te=D(1,1-d);c=D(1,l+(te-l)*(d*Ce))}return(l+c)/2},e[0].pressure),v=be(n,i,e[e.length-1].pressure,a),N,Q=e[0].vector,z=e[0].point,q=z,j=z,S=q,J=!1;for(let l=0;l<e.length;l++){let{pressure:p}=e[l],{point:c,vector:d,distance:te,runningLength:I}=e[l];if(l<e.length-1&&g-I<3)continue;if(i){if(s){let y=D(1,te/n),oe=D(1,1-y);p=D(1,K+(oe-K)*(y*Ce))}v=be(n,i,p,a)}else v=n/2;N===void 0&&(N=v);let Pe=I<k?u(I/k):1,De=g-I<R?b((g-I)/R):1;v=Math.max(.01,v*Math.min(Pe,De));let fe=(l<e.length-1?e[l+1]:e[l]).vector,ne=l<e.length-1?me(d,fe):1,Ae=me(d,Q)<0&&!J,he=ne!==null&&ne<0;if(Ae||he){let y=C(W(Q),v);for(let oe=1/13,T=0;T<=1;T+=oe)j=X(_(c,y),c,E*T),Y.push(j),S=X(w(c,y),c,E*-T),P.push(S);z=j,q=S,he&&(J=!0);continue}if(J=!1,l===e.length-1){let y=C(W(d),v);Y.push(_(c,y)),P.push(w(c,y));continue}let ge=C(W(ae(fe,d,ne)),v);j=_(c,ge),(l<=1||ve(z,j)>de)&&(Y.push(j),z=j),S=w(c,ge),(l<=1||ve(q,S)>de)&&(P.push(S),q=S),K=p,Q=d}let O=e[0].point.slice(0,2),M=e.length>1?e[e.length-1].point.slice(0,2):w(e[0].point,[1,1]),ee=[],H=[];if(e.length===1){if(!(k||R)||h){let l=_e(O,xe(W(_(O,M))),-(N||v)),p=[];for(let c=1/13,d=c;d<=1;d+=c)p.push(X(l,O,E*2*d));return p}}else{if(!(k||R&&e.length===1))if(m)for(let p=1/13,c=p;c<=1;c+=p){let d=X(P[0],O,E*c);ee.push(d)}else{let p=_(Y[0],P[0]),c=C(p,.5),d=C(p,.51);ee.push(_(O,c),_(O,d),w(O,d),w(O,c))}let l=W(Ve(e[e.length-1].vector));if(R||k&&e.length===1)H.push(M);else if(x){let p=_e(M,l,v);for(let c=1/29,d=c;d<1;d+=c)H.push(X(p,M,E*3*d))}else H.push(w(M,C(l,v)),w(M,C(l,v*.99)),_(M,C(l,v*.99)),_(M,C(l,v)))}return Y.concat(H,P.reverse(),ee)}function tt(e,t={}){var n;let{streamline:o=.5,size:i=16,last:s=!1}=t;if(e.length===0)return[];let a=.15+(1-o)*.85,r=Array.isArray(e[0])?e:e.map(({x:b,y:g,pressure:k=.5})=>[b,g,k]);if(r.length===2){let b=r[1];r=r.slice(0,-1);for(let g=1;g<5;g++)r.push(ae(r[0],b,g/4))}r.length===1&&(r=[...r,[...w(r[0],[1,1]),...r[0].slice(2)]]);let f=[{point:[r[0][0],r[0][1]],pressure:r[0][2]>=0?r[0][2]:.25,vector:[1,1],distance:0,runningLength:0}],h=!1,m=0,u=f[0],x=r.length-1;for(let b=1;b<r.length;b++){let g=s&&b===x?r[b].slice(0,2):ae(u.point,r[b],a);if(Ge(u.point,g))continue;let k=Qe(g,u.point);if(m+=k,b<x&&!h){if(m<i)continue;h=!0}u={point:g,pressure:r[b][2]>=0?r[b][2]:.5,vector:xe(_(u.point,g)),distance:k,runningLength:m},f.push(u)}return f[0].vector=((n=f[1])==null?void 0:n.vector)||[0,0],f}function nt(e,t={}){return et(tt(e,t),t)}var ot=nt;const we="drawnObjects";let $=!1,re=[[0,0]],A=null;const rt=({canvas:e,drawingSettings:t})=>{if(!e){console.error("drawStrokeOnCanvas: canvas is null");return}e.on("mouse:down",n=>{$=!0,A=null;const o=e.getPointer(n.e);re=[[o.x,o.y]]}),e.on("mouse:move",n=>{if(!$)return;e.discardActiveObject();const o=e.getPointer(n.e);re.push([o.x,o.y]);const i=ot(re,{size:t.size,thinning:t.thinning,smoothing:t.smoothing,streamline:t.streamline,easing(a){return a=Math.max(0,Math.min(1,a)),a*a*(3-2*a)}}),s=$e(i);L.fabric.loadSVGFromString(`<svg>
         <path fill="${t.stroke}" d="${s}" />
      </svg>`,a=>{const r=new L.fabric.Group(a,{id:we,selectable:!1,hasRotatingPoint:!1});A=r,e.add(r)})}),e.on("mouse:up",n=>{if(!$)return;const i=e.getObjects().filter(s=>(s==null?void 0:s.id)===we);if(i.length>0&&A){for(let s=0;s<i.length;s++)e.remove(i[s]);A.setOptions({selectable:!0,id:Se(),hasRotatingPoint:!0}),A.bringForward(!0),e.add(A),e.renderAll()}je(e),$=!1})},st=(e,t)=>{if(e)return setTimeout(()=>e.requestRenderAll(),t)},it=({canvas:e,backgroundColor:t})=>{e&&e.setBackgroundColor(t,()=>st(e,0))};let V=0,Z=0,se=!1;const at=({canvas:e})=>{e&&(e.on("mouse:down",t=>{var n,o,i;if(se=!0,t&&t.e&&t.e.type==="touchstart"){const s=t.e;V=(n=s==null?void 0:s.changedTouches[0])==null?void 0:n.clientX,Z=(o=s==null?void 0:s.changedTouches[0])==null?void 0:o.clientY}(i=t.target)==null||i.setOptions({opacity:.5})}),e.on("mouse:move",t=>{if(!(!se||!t||!t.e||t.target)){if(t.e.type==="mousemove"){const n=new L.fabric.Point(t.e.movementX,t.e.movementY);e.relativePan(n)}if(t.e.type==="touchmove"){const n=t.e,o=n==null?void 0:n.touches[0];if(!o)return;const i=.9;let s=(o.clientX-V)*i,a=(o.clientY-Z)*i;V=o.clientX,Z=o.clientY;const r=new L.fabric.Point(s,a);e.relativePan(r)}}}),e.on("mouse:up",t=>{var n;se=!1,(n=t.target)==null||n.setOptions({opacity:1}),V=0,Z=0}))},lt=Re();let G="",F=0,U=0,ie=!1;const ct=({canvas:e,squareModeSettings:t})=>{e&&(e.on("mouse:down",n=>{ie=!0;const o=e.getPointer(n.e);F=o.x,U=o.y;const i=new L.fabric.Rect({angle:0,top:U,left:F,evented:!1,originY:"top",originX:"left",selectable:!1,hasRotatingPoint:!1,width:o.x-F,height:o.y-U,rx:t.rx,ry:t.ry,stroke:t.stroke,strokeWidth:t.strokeWidth,fill:Ye({pasterns:lt,stroke:t.stroke,background:t.background})});i.id=Se(),G=i.id,e.add(i),e.renderAll()}),e.on("mouse:move",n=>{if(!ie||!G)return;const o=e.getPointer(n.e),s=e.getObjects().find(a=>a.id===G);s&&(F>o.x&&s.set({left:Math.abs(o.x)}),U>o.y&&s.set({top:Math.abs(o.y)}),s.setOptions({width:Math.abs(F-o.x),height:Math.abs(U-o.y)}),s.setCoords(),e.renderAll())}),e.on("mouse:up",n=>{ie=!1;const i=e.getObjects().find(s=>s.id===G);i&&(e.remove(i),i.setOptions({evented:!0,selectable:!0,hasRotatingPoint:!0}),i.setCoords(),e.add(i))}))},ke=e=>e==="drawing"||e==="panning",ut=e=>{if(!e){console.error("makeAllObjCanvasSelectable: canvas is null");return}e.selection=!0,e.forEachObject(t=>{t.setOptions({evented:!0,selectable:!0,hasControls:!0,hasRotatingPoint:!0})})},dt=le({__name:"MainCanvas",setup(e){const t=ze(),n=Ie(),o=B(null),{addListener:i,removeListener:s}=He(h=>{const m=n.getSelectedCanvas;m&&Te(h,m)}),a=h=>{n.setSelectedCanvas({selectedCanvas:h})},r=h=>{console.log("obj selected --->",h),i(),t.setCanvasMode({canvasMode:"ObjContextMenu"})},f=h=>{console.log("obj cleared --->",h),s(),t.setCanvasMode({canvasMode:"mainMenu"})};return We(()=>({getCanvasMode:t.getCanvasMode,getIsDotBackground:t.getIsDotBackground,getSelectedCanvas:n.getSelectedCanvas,getDrawingSettings:n.getDrawingSettings,getSquareModeSettings:n.getSquareModeSettings}),h=>{const{getCanvasMode:m,getSelectedCanvas:u,getDrawingSettings:x,getIsDotBackground:b,getSquareModeSettings:g}=h;switch(pe(u),ke(m)&&je(u),ke(m)||ut(u),t.getCanvasMode){case"drawing":rt({canvas:u,drawingSettings:x});break;case"panning":at({canvas:u});break;case"square":ct({canvas:u,squareModeSettings:g});break;case"mainMenu":break;case"ObjContextMenu":break;default:pe(u);break}it({canvas:u,backgroundColor:b?Xe({}):"transparent"})}),(h,m)=>(ce(),ue("div",{class:"design-canvas-container",ref_key:"elRef",ref:o},[ye(qe,{id:"1",onCanvasCreated:a,onSelectionCreated:r,onSelectionUpdated:r,onSelectionCleared:f})],512))}});const ft=Me(dt,[["__scopeId","data-v-8fb60cfc"]]),gt=le({__name:"DesignView",setup(e){return(t,n)=>(ce(),ue("main",null,[ye(ft)]))}});export{gt as default};
