import{d as ue,u as xe,b as Me,r as U,e as Be,f as k,o as fe,c as ce,a as We,_ as je,g as Ye,h as pe,i as Le,w as Xe,j as Se,k as Fe}from"./index-7ea54a02.js";const Te=({canvas:e,containerRef:t})=>{const n=(t==null?void 0:t.offsetWidth)||500,o=(t==null?void 0:t.offsetHeight)||500;e==null||e.setDimensions({width:n,height:o})},Ee=({canvas:e})=>{e.on("mouse:wheel",t=>{const n=t.e.deltaY;let o=e.getZoom();o*=.999**n,o>20&&(o=20),o<.01&&(o=.01),e.zoomToPoint({x:t.e.offsetX,y:t.e.offsetY},o),t.e.preventDefault(),t.e.stopPropagation()})},He=ue({__name:"FabricCanvas",props:{id:{}},emits:["mouse:dblclick","canvas-created"],setup(e,{emit:t}){xe(),Me();const n=U(null),o=U(null),i=U({width:0,height:0}),r=U(null);return Be(()=>{var l,f,O,C;const s=new k.fabric.Canvas(r.value,{width:((l=o.value)==null?void 0:l.offsetWidth)||500,height:((f=o.value)==null?void 0:f.offsetHeight)||500});s&&(n.value=s,t("canvas-created",s),s.on("mouse:dblclick",()=>{t("mouse:dblclick")}),i.value={width:((O=o.value)==null?void 0:O.offsetWidth)||500,height:((C=o.value)==null?void 0:C.offsetHeight)||500},Ee({canvas:s}),window.addEventListener("resize",()=>{Te({canvas:s,containerRef:o.value})}),window.addEventListener("keydown",m=>{if(m.key==="Backspace"){const x=s.getActiveObject();if(!x)return;s.remove(x)}}))}),(s,l)=>(fe(),ce("div",{class:"container",ref_key:"containerRef",ref:o},[We("canvas",{id:"canvas",ref_key:"canvasReference",ref:r,width:500,height:500},null,512)],512))}});const Ue=je(He,[["__scopeId","data-v-9ccb0b2b"]]),Pe=e=>{if(!e){console.error("makeAllObjCanvasUnselectable: canvas is null");return}e.selection=!1,e.discardActiveObject(),e.forEachObject(t=>{t.setOptions({evented:!1,selectable:!1,hasControls:!1,hasRotatingPoint:!1})})},$e=e=>{if(!e.length)return"";const t=e.reduce((n,[o,i],r,s)=>{const[l,f]=s[(r+1)%s.length];return n.push(o,i,(o+l)/2,(i+f)/2),n},["M",...e[0],"Q"]);return t.push("Z"),t.join(" ")},De=()=>`id-${Math.random().toString(16).slice(2)}`;function me(e,t,n,o=i=>i){return e*o(.5-t*(.5-n))}function Ve(e){return[-e[0],-e[1]]}function w(e,t){return[e[0]+t[0],e[1]+t[1]]}function b(e,t){return[e[0]-t[0],e[1]-t[1]]}function _(e,t){return[e[0]*t,e[1]*t]}function Ze(e,t){return[e[0]/t,e[1]/t]}function X(e){return[e[1],-e[0]]}function be(e,t){return e[0]*t[0]+e[1]*t[1]}function qe(e,t){return e[0]===t[0]&&e[1]===t[1]}function Ge(e){return Math.hypot(e[0],e[1])}function Ne(e){return e[0]*e[0]+e[1]*e[1]}function _e(e,t){return Ne(b(e,t))}function Ae(e){return Ze(e,Ge(e))}function Je(e,t){return Math.hypot(e[1]-t[1],e[0]-t[0])}function F(e,t,n){let o=Math.sin(n),i=Math.cos(n),r=e[0]-t[0],s=e[1]-t[1],l=r*i-s*o,f=r*o+s*i;return[l+t[0],f+t[1]]}function le(e,t,n){return w(e,_(b(t,e),n))}function we(e,t,n){return w(e,_(t,n))}var{min:I,PI:Ke}=Math,ke=.275,T=Ke+1e-4;function Qe(e,t={}){let{size:n=16,smoothing:o=.5,thinning:i=.5,simulatePressure:r=!0,easing:s=u=>u,start:l={},end:f={},last:O=!1}=t,{cap:C=!0,easing:m=u=>u*(2-u)}=l,{cap:x=!0,easing:g=u=>--u*u*u+1}=f;if(e.length===0||n<=0)return[];let h=e[e.length-1].runningLength,y=l.taper===!1?0:l.taper===!0?Math.max(n,h):l.taper,B=f.taper===!1?0:f.taper===!0?Math.max(n,h):f.taper,de=Math.pow(n*o,2),W=[],R=[],J=e.slice(0,10).reduce((u,a)=>{let c=a.pressure;if(r){let d=I(1,a.distance/n),te=I(1,1-d);c=I(1,u+(te-u)*(d*ke))}return(u+c)/2},e[0].pressure),p=me(n,i,e[e.length-1].pressure,s),K,Q=e[0].vector,Y=e[0].point,$=Y,D=Y,A=$,v=!1;for(let u=0;u<e.length;u++){let{pressure:a}=e[u],{point:c,vector:d,distance:te,runningLength:L}=e[u];if(u<e.length-1&&h-L<3)continue;if(i){if(r){let S=I(1,te/n),oe=I(1,1-S);a=I(1,J+(oe-J)*(S*ke))}p=me(n,i,a,s)}else p=n/2;K===void 0&&(K=p);let Re=L<y?m(L/y):1,Ie=h-L<B?g((h-L)/B):1;p=Math.max(.01,p*Math.min(Re,Ie));let ae=(u<e.length-1?e[u+1]:e[u]).vector,ne=u<e.length-1?be(d,ae):1,ze=be(d,Q)<0&&!v,he=ne!==null&&ne<0;if(ze||he){let S=_(X(Q),p);for(let oe=1/13,Z=0;Z<=1;Z+=oe)D=F(b(c,S),c,T*Z),W.push(D),A=F(w(c,S),c,T*-Z),R.push(A);Y=D,$=A,he&&(v=!0);continue}if(v=!1,u===e.length-1){let S=_(X(d),p);W.push(b(c,S)),R.push(w(c,S));continue}let ge=_(X(le(ae,d,ne)),p);D=b(c,ge),(u<=1||_e(Y,D)>de)&&(W.push(D),Y=D),A=w(c,ge),(u<=1||_e($,A)>de)&&(R.push(A),$=A),J=a,Q=d}let M=e[0].point.slice(0,2),j=e.length>1?e[e.length-1].point.slice(0,2):w(e[0].point,[1,1]),ee=[],V=[];if(e.length===1){if(!(y||B)||O){let u=we(M,Ae(X(b(M,j))),-(K||p)),a=[];for(let c=1/13,d=c;d<=1;d+=c)a.push(F(u,M,T*2*d));return a}}else{if(!(y||B&&e.length===1))if(C)for(let a=1/13,c=a;c<=1;c+=a){let d=F(R[0],M,T*c);ee.push(d)}else{let a=b(W[0],R[0]),c=_(a,.5),d=_(a,.51);ee.push(b(M,c),b(M,d),w(M,d),w(M,c))}let u=X(Ve(e[e.length-1].vector));if(B||y&&e.length===1)V.push(j);else if(x){let a=we(j,u,p);for(let c=1/29,d=c;d<1;d+=c)V.push(F(a,j,T*3*d))}else V.push(w(j,_(u,p)),w(j,_(u,p*.99)),b(j,_(u,p*.99)),b(j,_(u,p)))}return W.concat(V,R.reverse(),ee)}function ve(e,t={}){var n;let{streamline:o=.5,size:i=16,last:r=!1}=t;if(e.length===0)return[];let s=.15+(1-o)*.85,l=Array.isArray(e[0])?e:e.map(({x:g,y:h,pressure:y=.5})=>[g,h,y]);if(l.length===2){let g=l[1];l=l.slice(0,-1);for(let h=1;h<5;h++)l.push(le(l[0],g,h/4))}l.length===1&&(l=[...l,[...w(l[0],[1,1]),...l[0].slice(2)]]);let f=[{point:[l[0][0],l[0][1]],pressure:l[0][2]>=0?l[0][2]:.25,vector:[1,1],distance:0,runningLength:0}],O=!1,C=0,m=f[0],x=l.length-1;for(let g=1;g<l.length;g++){let h=r&&g===x?l[g].slice(0,2):le(m.point,l[g],s);if(qe(m.point,h))continue;let y=Je(h,m.point);if(C+=y,g<x&&!O){if(C<i)continue;O=!0}m={point:h,pressure:l[g][2]>=0?l[g][2]:.5,vector:Ae(b(m.point,h)),distance:y,runningLength:C},f.push(m)}return f[0].vector=((n=f[1])==null?void 0:n.vector)||[0,0],f}function et(e,t={}){return Qe(ve(e,t),t)}var tt=et;const Ce="drawnObjects";let q=!1,re=[[0,0]],z=null;const nt=({canvas:e,drawingMode:t})=>{if(!e){console.error("drawStrokeOnCanvas: canvas is null");return}e==null||e.off("mouse:up"),e==null||e.off("mouse:move"),e==null||e.off("mouse:down"),e.on("mouse:down",n=>{q=!0,z=null;const o=e.getPointer(n.e);re=[[o.x,o.y]]}),e.on("mouse:move",n=>{if(!q)return;e.discardActiveObject();const o=e.getPointer(n.e);re.push([o.x,o.y]);const i=tt(re,{size:t.size,thinning:t.thinning,smoothing:t.smoothing,streamline:t.streamline,easing(s){return s=Math.max(0,Math.min(1,s)),s*s*(3-2*s)}}),r=$e(i);k.fabric.loadSVGFromString(`<svg>
         <path fill="${t.stroke}" d="${r}" />
      </svg>`,s=>{const l=new k.fabric.Group(s,{id:Ce,selectable:!1,hasRotatingPoint:!1});z=l,e.add(l)})}),e.on("mouse:up",n=>{if(!q)return;const i=e.getObjects().filter(r=>(r==null?void 0:r.id)===Ce);if(i.length>0&&z){for(let r=0;r<i.length;r++)e.remove(i[r]);z.setOptions({selectable:!0,id:De(),hasRotatingPoint:!0}),z.bringForward(!0),e.add(z),e.renderAll()}Pe(e),q=!1})},ot=(e,t)=>{if(e)return setTimeout(()=>e.requestRenderAll(),t)},rt=({canvas:e,backgroundColor:t})=>{e&&e.setBackgroundColor(t,()=>ot(e,0))};let G=0,N=0,ie=!1;const it=({canvas:e})=>{e&&(e==null||e.off("mouse:up"),e==null||e.off("mouse:move"),e==null||e.off("mouse:down"),e.on("mouse:down",t=>{var n,o,i;if(ie=!0,t&&t.e&&t.e.type==="touchstart"){const r=t.e;G=(n=r==null?void 0:r.changedTouches[0])==null?void 0:n.clientX,N=(o=r==null?void 0:r.changedTouches[0])==null?void 0:o.clientY}(i=t.target)==null||i.setOptions({opacity:.5})}),e.on("mouse:move",t=>{if(!(!ie||!t||!t.e||t.target)){if(t.e.type==="mousemove"){const n=new k.fabric.Point(t.e.movementX,t.e.movementY);e.relativePan(n)}if(t.e.type==="touchmove"){const n=t.e,o=n==null?void 0:n.touches[0];if(!o)return;const i=.9;let r=(o.clientX-G)*i,s=(o.clientY-N)*i;G=o.clientX,N=o.clientY;const l=new k.fabric.Point(r,s);e.relativePan(l)}}}),e.on("mouse:up",t=>{var n;ie=!1,(n=t.target)==null||n.setOptions({opacity:1}),G=0,N=0}))},st=({canvas:e,action:t})=>{e==null||e.off("mouse:up"),e==null||e.off("mouse:move"),e==null||e.off("mouse:down"),e==null||e.on("mouse:up",n=>{const i=e.getActiveObjects().map(r=>(r==null?void 0:r.id)||"no id");if(i.length>0){t("ObjContextMenu",i);return}t("mainMenu",[])})},ye=Ye();let P="",E=0,H=0,se=!1;const lt=({canvas:e,endAction:t,squareModeSettings:n})=>{if(e){if(e==null||e.off("mouse:up"),e==null||e.off("mouse:move"),e==null||e.off("mouse:down"),P){const i=e.getObjects().find(r=>r.id===P);if(!i)return;Le({rect:i,squareSettings:n,pattern:pe({pasterns:ye,stroke:n.stroke,background:n.background})}),e.renderAll()}e.on("mouse:down",o=>{if(P!==""){P="",t();return}se=!0;const i=e.getPointer(o.e);E=i.x,H=i.y;const r=new k.fabric.Rect({angle:0,top:H,left:E,evented:!0,originY:"top",originX:"left",selectable:!0,hasRotatingPoint:!0,width:i.x-E,height:i.y-H,rx:n.rx,ry:n.ry,stroke:n.stroke,strokeWidth:n.strokeWidth,fill:pe({pasterns:ye,stroke:n.stroke,background:n.background})});r.id=De(),P=r.id,e.add(r)}),e.on("mouse:move",o=>{if(!se||!P)return;const i=e.getPointer(o.e),s=e.getObjects().find(l=>l.id===P);s&&(E>i.x&&s.set({left:Math.abs(i.x)}),H>i.y&&s.set({top:Math.abs(i.y)}),s.setOptions({width:Math.abs(E-i.x),height:Math.abs(H-i.y)}),e.renderAll())}),e.on("mouse:up",o=>{e.getObjects().find(s=>s.id===P)&&(se=!1)})}},Oe=e=>e==="drawing"||e==="panning",ut=e=>{if(!e){console.error("makeAllObjCanvasSelectable: canvas is null");return}e.selection=!0,e.forEachObject(t=>{t.setOptions({evented:!0,selectable:!0,hasControls:!0,hasRotatingPoint:!0})})},ft=e=>{e==null||e.off("mouse:up"),e==null||e.off("mouse:move"),e==null||e.off("mouse:down")},ct=ue({__name:"MainDesign",setup(e){const t=xe(),n=Me(),o=U(null),i=r=>{n.setSelectedCanvas({selectedCanvas:r});const s=r.getCenter();new k.fabric.Circle({radius:20,fill:"#4f46e5",top:s.top+100,left:s.left+100}),new k.fabric.Triangle({width:60,height:70,fill:"#c026d3",top:s.top+50,left:s.left+50}),new k.fabric.IText("Test text",{fontSize:22,top:s.top,left:s.left,hasControls:!0,fontStyle:"normal",fontWeight:"normal",fontFamily:"Helvetica"}),new k.fabric.Line([80,10,200,150],{stroke:"#374151"}),new k.fabric.Polyline([{x:80,y:10},{x:200,y:150},{x:500,y:250}],{stroke:"#ea580c",fill:"transparent",strokeWidth:5,strokeLineCap:"round",strokeLineJoin:"round"})};return Xe(()=>({getCanvasMode:t.getCanvasMode,getDrawingMode:n.getDrawingMode,getIsDotBackground:t.getIsDotBackground,getSelectedCanvas:n.getSelectedCanvas,getSquareModeSettings:n.getSquareModeSettings}),r=>{const{getCanvasMode:s,getDrawingMode:l,getSelectedCanvas:f,getIsDotBackground:O,getSquareModeSettings:C}=r;switch(Oe(s)&&Pe(f),Oe(s)||ut(f),t.getCanvasMode){case"drawing":nt({canvas:f,drawingMode:l});break;case"panning":it({canvas:f});break;case"square":lt({canvas:f,squareModeSettings:C,endAction:()=>{t.setCanvasMode({canvasMode:"mainMenu"})}});break;case"mainMenu":case"ObjContextMenu":st({canvas:f,action:(m,x)=>{t.setCanvasMode({canvasMode:m}),n.setSelectedObjectIds({selectedObjectIds:x})}});break;default:ft(f);break}rt({canvas:f,backgroundColor:O?Fe({}):"transparent"})}),(r,s)=>(fe(),ce("div",{class:"design-canvas-container",ref_key:"elRef",ref:o},[Se(Ue,{onCanvasCreated:i,id:"1"})],512))}});const dt=je(ct,[["__scopeId","data-v-461619e1"]]),ht=ue({__name:"DesignView",setup(e){return(t,n)=>(fe(),ce("main",null,[Se(dt)]))}});export{ht as default};
